<div class="title">
  <h1>Colaboradores</h1>
</div>

<!-- BotÃ³n para abrir el modal de subir archivo -->
<button (click)="openExcelModal()">Subir colaboradores â¬†ï¸</button>

<!-- BotÃ³n para descargar el listado de colaboradores -->
<button (click)="confirmDownload()">Descargar listado de colaboradores â¬‡ï¸</button>

<!-- BotÃ³n para agrear nuevo grupo de categorÃ­a de colaboradores -->
<button (click)="addGroupCategory()">Agregar Grupo â•</button>

<!-- Modal para subir archivo -->
<div class="modal-overlay" *ngIf="isModalOpen">
  <div class="modal-content">
    <h2>Subir Archivo de Colaboradores</h2>

    <!-- Input de selecciÃ³n de archivo -->
    <input type="file" (change)="onExcelFileSelected($event)" accept=".xlsx" />

    <!-- BotÃ³n para enviar los datos despuÃ©s de la selecciÃ³n y validaciÃ³n -->
    <button class="upex" (click)="confirmUpload()">Subir archivo</button>
    <!-- BotÃ³n de cierre del modal -->
    <button class="upex" (click)="closeExcelModal()">Cancelar âŒ</button>
  </div>
</div>

<!-- Mensaje de Ã©xito -->
<div *ngIf="successMessage" class="success-message">
  {{ successMessage }}
</div>

<div *ngIf="isAddingGroupCategory" class="modal-overlay">
  <div class="modal-content">
    <h3>Agregar Nuevo Grupo de CategorÃ­a</h3>

    <!-- Campo de entrada para el nombre de la nueva categorÃ­a de grupo -->
    <input
      type="text"
      [(ngModel)]="newGroupCategory.name"
      placeholder="Nombre de la categorÃ­a"
    />

    <!-- SelecciÃ³n del tipo de grupo (Administrativo o Docente) -->
    <div class="select">
      <label>
        <input
          type="radio"
          name="groupType"
          [(ngModel)]="newGroupCategory.type"
          [value]="true"
        />
        Administrativo
      </label>
      <label>
        <input
          type="radio"
          name="groupType"
          [(ngModel)]="newGroupCategory.type"
          [value]="false"
        />
        Docente
      </label>
    </div>

    <!-- Mensaje de error si existe -->
    <p *ngIf="errorMessage" class="error">{{ errorMessage }}</p>

    <!-- BotÃ³n para guardar la nueva categorÃ­a, llama a saveNewGroupCategory() -->
    <button (click)="saveNewGroupCategory()" class="addg">Guardar ğŸ’¾</button>

    <!-- BotÃ³n para cancelar la acciÃ³n, llama a cancelAddingGroup() -->
    <button (click)="cancelAddingGroup()" class="addg">Cancelar âŒ</button>
  </div>
</div>


<hr class="custom-line" />
<!-- Encabezado de la secciÃ³n de docentes -->
<div class="subtitle">
  <h2 class="sub"><strong>DOCENTES ğŸ“’ </strong></h2>
</div>
<hr class="custom-line" />
<div
  class="group-category-list"
  cdkDropList
  (cdkDropListDropped)="drop($event)"
>
  <div class="categories">
    <!-- Itera sobre cada categorÃ­a de grupo en groupCategories y aplica cdkDrag para hacer los elementos arrastrables -->
    <div
      *ngFor="let groupcategory of groupCategories"
      class="group-category"
      cdkDrag
    >
      <!-- Solo muestra categorÃ­as que no son administrativas -->
      <ng-container *ngIf="!groupcategory.is_administrative">
        <div class="group-category-item" cdkDrag>
          <div class="grupo">
            <div class="handle">
              <h2>
                <span class="drag-handle" cdkDragHandle>â‹®</span>
                {{ groupcategory.group_category_name }}
              </h2>
            </div>

            <div class="btn-gr">
              <!-- BotÃ³n para editar la categorÃ­a de grupo de colaboradores -->
              <button (click)="openEditModal(groupcategory.id_group_category)">
                Editar âœï¸
              </button>
              <!-- BotÃ³n para abrir el modal de agregar subcategorÃ­a, llama a openAddCategoryModal() -->
              <button
                (click)="openAddCategoryModal(groupcategory.id_group_category)"
              >
                Agregar CategorÃ­a â•
              </button>
              <!-- BotÃ³n para eliminar la categorÃ­a de grupo, llama a prepareDeleteGroupCategory() -->
              <button
                class="delete"
                (click)="
                  prepareDeleteGroupCategory(groupcategory.id_group_category)
                "
              >
                Eliminar ğŸ—‘ï¸
              </button>
            </div>

            <div
              *ngIf="
                isEditingGroupCategory &&
                selectedGroupCategoryId === groupcategory.id_group_category
              "
              class="modal-overlay"
            >
              <div class="modal-content">
                <h3>Editar CategorÃ­a de Grupo</h3>
                <!-- Campo de entrada para actualizar el nombre de la categorÃ­a de grupo -->
                <input
                  type="text"
                  [(ngModel)]="editGroupCategoryData.name"
                  placeholder="Nuevo nombre de la categorÃ­a"
                />
                <!-- Mensaje de error si existe -->
                <p *ngIf="errorMessage" class="error">{{ errorMessage }}</p>
                <!-- BotÃ³n para guardar la actualizaciÃ³n -->
                <button (click)="updateGroupCategory()">Guardar ğŸ’¾</button>
                <!-- BotÃ³n para cerrar el modal sin guardar -->
                <button (click)="closeEditModal()">Cancelar âŒ</button>
              </div>
            </div>

            <div
              *ngIf="
                isAddingCategory &&
                selectedGroupCategoryId === groupcategory.id_group_category
              "
              class="modal-overlay"
            >
              <div class="modal-content">
                <h5>
                  Agregar Nueva CategorÃ­a a
                  {{ groupcategory.group_category_name }}
                </h5>
                <!-- Campo de entrada para el nombre de la nueva subcategorÃ­a -->
                <input
                  type="text"
                  [(ngModel)]="newCategory.name"
                  placeholder="Nombre de la categorÃ­a"
                />
                <!-- Mensaje de error si existe -->
                <p *ngIf="errorMessage" class="error">{{ errorMessage }}</p>
                <!-- BotÃ³n para guardar la subcategorÃ­a -->
                <button (click)="saveNewCategory()">Guardar ğŸ’¾</button>
                <!-- BotÃ³n para cancelar la acciÃ³n -->
                <button (click)="closeAddCategoryModal()">Cancelar âŒ</button>
              </div>
            </div>

            <div class="card">
              <!-- Itera sobre cada subcategorÃ­a en el grupo actual usando getCategoriesByGroupId() -->
              <div
                *ngFor="
                  let category of getCategoriesByGroupId(
                    groupcategory.id_group_category
                  )
                "
                class="category-card"
                cdkDropList
                (cdkDropListDropped)="dropCategory($event)"
              >
                <!-- Muestra el nombre de la subcategorÃ­a o "Sin nombre" si estÃ¡ vacÃ­o -->
                <h3>
                  {{ category.collaborator_category_name || "Sin nombre" }}
                </h3>
                <div class="btn-cat">
                  <!-- BotÃ³n para ver los colaboradores de la subcategorÃ­a, llama a navigateToCollaborators() -->
                  <button
                    (click)="
                      navigateToCollaborators(category.id_collaborator_category)
                    "
                  >
                    Colaboradores ğŸ‘¥
                  </button>

                  <!-- BotÃ³n para editar la categorÃ­a, llama a openEditCategoryModal() -->
                  <button (click)="openEditCategoryModal(category)">
                    Editar âœï¸
                  </button>
                  <!-- BotÃ³n para eliminar la subcategorÃ­a, llama a deleteCategory() -->
                  <button
                    class="delete"
                    (click)="deleteCategory(category.id_collaborator_category)"
                  >
                    Eliminar ğŸ—‘ï¸
                  </button>
                  <!-- Modal para editar la subcategorÃ­a -->
                  <div
                    *ngIf="
                      editingCategoryId === category.id_collaborator_category
                    "
                    class="modal-overlay"
                  >
                    <div class="modal-content">
                      <h3>Editar Nombre de la CategorÃ­a</h3>
                      <!-- Campo de entrada para el nuevo nombre de la categorÃ­a -->
                      <input
                        type="text"
                        [(ngModel)]="editCategoryData.name"
                        placeholder="Nuevo nombre de la categorÃ­a"
                        id="editCategoryName-{{
                          category.id_collaborator_category
                        }}"
                        name="editCategoryName"
                      />

                      <!-- Mensaje de error si existe -->
                      <p *ngIf="errorMessage" class="error">
                        {{ errorMessage }}
                      </p>
                      <!-- BotÃ³n para guardar los cambios -->
                      <button (click)="saveCategoryChanges()">
                        Guardar ğŸ’¾
                      </button>
                      <!-- BotÃ³n para cancelar la ediciÃ³n -->
                      <button (click)="closeEditCategoryModal()">
                        Cancelar âŒ
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Mensaje que aparece si el grupo no tiene subcategorÃ­as -->
              <p
                *ngIf="
                  getCategoriesByGroupId(groupcategory.id_group_category)
                    .length === 0
                "
              >
                No hay categorÃ­as en este grupo.
              </p>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>

<hr class="custom-line" />

<!-- Encabezado de la secciÃ³n de administrativos -->
<div class="subtitle">
  <h2 class="sub"><strong>ADMINISTRATIVOS ğŸ—‚ï¸ </strong></h2>
</div>
<hr class="custom-line" />
<div
  class="group-category-list mat-no-styling"
  cdkDropList
  (cdkDropListDropped)="drop($event)"
>
  <div class="categories">
    <div
      *ngFor="let groupcategory of groupCategories"
      class="group-category-item mat-no-styling"
      cdkDrag
    >
      <!-- Solo muestra categorÃ­as que son administrativas -->
      <div *ngIf="groupcategory.is_administrative">
        <div class="grupo">
          <h2>
            <div class="handle mat-no-styling">
              <span class="drag-handle" cdkDragHandle>â‹®</span>
              {{ groupcategory.group_category_name }}
              >
            </div>
          </h2>

          <br />
          <div class="btn-gr mat-no-styling">
            <button (click)="openEditModal(groupcategory.id_group_category)">
              Editar âœï¸
            </button>
            <!-- Modal para editar la categorÃ­a de grupo -->
            <div
              *ngIf="
                isEditingGroupCategory &&
                selectedGroupCategoryId === groupcategory.id_group_category
              "
              class="modal-overlay"
            >
              <div class="modal-content">
                <h3>Editar CategorÃ­a de Grupo</h3>
                <!-- Campo de entrada para actualizar el nombre de la categorÃ­a de grupo -->
                <input
                  type="text"
                  [(ngModel)]="editGroupCategoryData.name"
                  placeholder="Nuevo nombre de la categorÃ­a"
                />
                <!-- Mensaje de error si existe -->
                <p *ngIf="errorMessage" class="error">{{ errorMessage }}</p>
                <!-- BotÃ³n para guardar la actualizaciÃ³n -->
                <button (click)="updateGroupCategory()">Guardar ğŸ’¾</button>
                <!-- BotÃ³n para cerrar el modal sin guardar -->
                <button (click)="closeEditModal()">Cancelar âŒ</button>
              </div>
            </div>
            <!-- BotÃ³n para abrir el modal de agregar subcategorÃ­a en un grupo administrativo -->
            <button
              (click)="openAddCategoryModal(groupcategory.id_group_category)"
            >
              Agregar CategorÃ­a â•
            </button>

            <!-- Modal para agregar una nueva subcategorÃ­a en grupo administrativo -->
            <div
              *ngIf="
                isAddingCategory &&
                selectedGroupCategoryId === groupcategory.id_group_category
              "
              class="modal-overlay"
            >
              <div class="modal-content">
                <h5>
                  Agregar Nueva CategorÃ­a a
                  {{ groupcategory.group_category_name }}
                </h5>
                <input
                  type="text"
                  [(ngModel)]="newCategory.name"
                  placeholder="Nombre de la categorÃ­a"
                />
                <p *ngIf="errorMessage" class="error">{{ errorMessage }}</p>
                <button (click)="saveNewCategory()">Guardar ğŸ’¾</button>
                <button (click)="closeAddCategoryModal()">Cancelar âŒ</button>
              </div>
            </div>

            <!-- BotÃ³n para eliminar la categorÃ­a de grupo, llama a prepareDeleteGroupCategory() -->
            <button
              class="delete"
              (click)="
                prepareDeleteGroupCategory(groupcategory.id_group_category)
              "
            >
              Eliminar ğŸ—‘ï¸
            </button>
          </div>

          <div class="card mat-no-styling">
            <!-- Itera sobre cada subcategorÃ­a en el grupo administrativo -->
            <div
              *ngFor="
                let category of getCategoriesByGroupId(
                  groupcategory.id_group_category
                )
              "
              class="category-card mat-no-styling"
              cdkDropList
              (cdkDropListDropped)="dropCategory($event)"
              cdkDrag
            >
              <span
                ><h3>
                  {{ category.collaborator_category_name || "Sin nombre" }}
                </h3></span
              >

              <div class="btn-cat">
                <button
                  (click)="
                    navigateToCollaborators(category.id_collaborator_category)
                  "
                >
                  Colaboradores ğŸ‘¥
                </button>
                <!-- BotÃ³n para editar la categorÃ­a, llama a openEditCategoryModal() -->
                <button (click)="openEditCategoryModal(category)">
                  Editar âœï¸
                </button>
                <button
                  class="delete"
                  (click)="deleteCategory(category.id_collaborator_category)"
                >
                  Eliminar ğŸ—‘ï¸
                </button>
                <!-- Modal para editar la subcategorÃ­a -->
                <div
                  *ngIf="
                    editingCategoryId === category.id_collaborator_category
                  "
                  class="modal-overlay"
                >
                  <div class="modal-content">
                    <h3>Editar Nombre de la CategorÃ­a</h3>
                    <!-- Campo de entrada para el nuevo nombre de la categorÃ­a -->
                    <input
                      type="text"
                      [(ngModel)]="editCategoryData.name"
                      placeholder="Nuevo nombre de la categorÃ­a"
                      id="editCategoryName-{{
                        category.id_collaborator_category
                      }}"
                      name="editCategoryName"
                    />

                    <!-- Mensaje de error si existe -->
                    <p *ngIf="errorMessage" class="error">{{ errorMessage }}</p>
                    <!-- BotÃ³n para guardar los cambios -->
                    <button (click)="saveCategoryChanges()">Guardar ğŸ’¾</button>
                    <!-- BotÃ³n para cancelar la ediciÃ³n -->
                    <button (click)="closeEditCategoryModal()">
                      CancelarâŒ
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Mensaje que aparece si no hay subcategorÃ­as en el grupo -->
            <p
              *ngIf="
                getCategoriesByGroupId(groupcategory.id_group_category)
                  .length === 0
              "
            >
              No hay categorÃ­as en este grupo.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
