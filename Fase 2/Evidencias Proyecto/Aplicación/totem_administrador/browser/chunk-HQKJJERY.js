import{a as F}from"./chunk-FWSTF5EQ.js";import"./chunk-NRKFFC3A.js";import{k as E,m as T}from"./chunk-X2DCTIRQ.js";import{Ab as c,Bb as C,Cb as _,Ia as w,Ib as P,Ka as s,Kb as I,La as h,Ya as g,ab as l,ga as y,hb as r,ib as a,jb as v,mb as u,ob as d,pa as p,qa as f,qb as m,qc as N,rc as O,sc as k,tb as M,wc as S}from"./chunk-INDI3DVQ.js";var z=n=>({"active-post":n});function B(n,t){if(n&1){let e=u();r(0,"button",19),d("click",function(){p(e);let o=m();return f(o.loadPreviousPage())}),c(1," P\xE1gina Anterior "),a()}}function L(n,t){if(n&1){let e=u();r(0,"button",19),d("click",function(){p(e);let o=m();return f(o.loadNextPage())}),c(1," Siguiente P\xE1gina "),a()}}function $(n,t){n&1&&(r(0,"div",20)(1,"div",21)(2,"span",22),c(3,"Cargando..."),a()()())}function j(n,t){n&1&&(r(0,"span",33),c(1," Activa "),a())}function q(n,t){if(n&1&&(r(0,"div"),v(1,"img",34),a()),n&2){let e=m().$implicit;s(),M("alt",e.caption),l("src",e.media_url,w)}}function D(n,t){if(n&1&&(r(0,"div"),v(1,"video",35),a()),n&2){let e=m().$implicit;s(),l("src",e.media_url,w)}}function R(n,t){if(n&1&&(r(0,"a",36),c(1," Ver en Instagram "),a()),n&2){let e=m().$implicit;l("href",e.permalink,w)}}function G(n,t){if(n&1){let e=u();r(0,"div",25),g(1,j,2,0,"span",26),r(2,"h4",27),c(3),a(),r(4,"div",28),g(5,q,2,2,"div",29)(6,D,2,1,"div",29),a(),r(7,"div",30),g(8,R,2,1,"a",31),r(9,"button",32),d("click",function(){let o=p(e).$implicit,b=m(2);return f(b.addPostToNews(o.id))}),c(10),a()()()}if(n&2){let e=t.$implicit;l("ngClass",I(8,z,e.is_active===!0)),s(),l("ngIf",e.is_active),s(2),C(e.caption),s(2),l("ngIf",e.media_type==="IMAGE"),s(),l("ngIf",e.media_type==="VIDEO"),s(2),l("ngIf",e.permalink),s(),l("disabled",e.is_active),s(),_(" ",e.is_active?"Noticia Agregada":"Agregar a Noticias"," ")}}function U(n,t){if(n&1&&(r(0,"div",23),g(1,G,11,10,"div",24),a()),n&2){let e=m();s(),l("ngForOf",e.posts)}}function Y(n,t){if(n&1&&(r(0,"div",37),c(1),a()),n&2){let e=m();s(),_(" \u2714\uFE0F ",e.successMessage," ")}}function W(n,t){if(n&1&&(r(0,"div",38),c(1),a()),n&2){let e=m();s(),_(" \u26A0\uFE0F ",e.errorMessage," ")}}function H(n,t){if(n&1){let e=u();r(0,"button",19),d("click",function(){p(e);let o=m();return f(o.loadPreviousPage())}),c(1," P\xE1gina Anterior "),a()}}function J(n,t){if(n&1){let e=u();r(0,"button",19),d("click",function(){p(e);let o=m();return f(o.loadNextPage())}),c(1," Siguiente P\xE1gina "),a()}}var V=class n{constructor(t,e){this.newsService=t;this.router=e}posts=[];paging={};currentPage=1;isLoading=!1;successMessage="";errorMessage="";activeMessage=!1;ngOnInit(){this.loadFirstPage()}showTemporaryMessage(t,e,i=5e3){t==="success"?this.successMessage=e:t==="error"&&(this.errorMessage=e),this.activeMessage=!0,setTimeout(()=>{this.activeMessage=!1,t==="success"?this.successMessage="":t==="error"&&(this.errorMessage="")},i)}loadFirstPage(){let t=this.newsService.getFirstPageWithActiveStatus();this.loadPage(t,1)}loadNextPage(){if(this.paging.after){let t=this.newsService.getInstagramPostsByPage("after",this.paging.after);this.loadPage(t,this.currentPage+1)}}loadPreviousPage(){if(this.paging.before){let t=this.newsService.getInstagramPostsByPage("before",this.paging.before);this.loadPage(t,this.currentPage-1)}}loadPage(t,e){this.isLoading=!0,t.subscribe(i=>{let o=i.data;this.newsService.getAllNews().subscribe(b=>{let A=b.data.filter(x=>x.id_instagram_post).map(x=>x.id_instagram_post.toString());this.posts=o.filter(x=>!A.includes(x.id.toString())),this.paging=i.paging,this.currentPage=e,this.isLoading=!1},b=>{this.showTemporaryMessage("error","No hay m\xE1s p\xE1ginas que mostrar"),console.error("No hay m\xE1s p\xE1ginas que mostrar",b),this.isLoading=!1})},i=>{this.showTemporaryMessage("error","No hay m\xE1s p\xE1ginas que mostrar"),console.error("No hay m\xE1s p\xE1ginas que mostrar",i),this.isLoading=!1})}addPostToNews(t){this.newsService.addInstagramNews(t.toString()).subscribe(e=>{this.showTemporaryMessage("success","Publicaci\xF3n agregada correctamente a las noticias");let i=this.posts.findIndex(o=>o.id===t);i!==-1&&(this.posts[i].is_active=!0)},e=>{this.showTemporaryMessage("error","Error al agregar la publicaci\xF3n a noticias"),console.error("Error al agregar la publicaci\xF3n a noticias",e)})}hasAutomaticNews(t){return this.posts.some(e=>e.is_active&&e.media_type?.toLowerCase()===t)}createAutomaticNews(t){this.newsService.getAllNews().subscribe(e=>{if(e.data.filter(o=>o.is_automatic&&o.media_type?.toLowerCase()===t).length>0){this.showTemporaryMessage("error",`Ya existe una noticia autom\xE1tica de ${t==="image"?"imagen":"video"}.`);return}this.newsService.createAutomaticNews(t).subscribe(o=>{this.showTemporaryMessage("success",`Noticia automatica de ${t==="image"?"imagen":"video"} creada con \xE9xito.`),this.loadFirstPage()},o=>{this.showTemporaryMessage("error","Error al crear noticia autom\xE1tica."),console.error("Error al crear noticia autom\xE1tica",o)})},e=>{this.showTemporaryMessage("error","Error al verificar las noticias autom\xE1ticas."),console.error("Error al verificar las noticias autom\xE1ticas",e)})}goBack(){this.router.navigate(["/news"])}static \u0275fac=function(e){return new(e||n)(h(F),h(E))};static \u0275cmp=y({type:n,selectors:[["app-news-instagram"]],standalone:!0,features:[P],decls:32,vars:10,consts:[[1,"container-fluid"],[1,"text-primary","text-center"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"btn","btn-info",3,"click"],[1,"btn","btn-primary",3,"click"],[1,"mb-4"],[2,"font-size","1.5rem","font-family","'Merriweather'"],[1,"d-flex"],[1,"btn","btn-success","me-2",3,"click"],[1,"btn","btn-success",3,"click"],[1,"pagination-controls","text-center","mb-4"],[1,"pagination-buttons","d-inline-flex","align-items-center","justify-content-center"],["class","btn btn-outline-secondary action-button mx-2",3,"click",4,"ngIf"],[1,"current-page","mx-3"],["class","d-flex justify-content-center mt-4",4,"ngIf"],["class","news-grid",4,"ngIf"],["class","alert alert-success text-center alert-confirmation fixed-center",4,"ngIf"],["class","alert alert-danger text-center alert-confirmation fixed-center",4,"ngIf"],[1,"pagination-controls","text-center","mt-4"],[1,"btn","btn-outline-secondary","action-button","mx-2",3,"click"],[1,"d-flex","justify-content-center","mt-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"news-grid"],["class","news-item p-3 border rounded shadow-sm position-relative",3,"ngClass",4,"ngFor","ngForOf"],[1,"news-item","p-3","border","rounded","shadow-sm","position-relative",3,"ngClass"],["class","badge badge-success position-absolute top-0 start-0 m-2",4,"ngIf"],[1,"text-secondary","mt-4"],[1,"media-container","mt-3"],[4,"ngIf"],[1,"mt-3"],["target","_blank","class","btn btn-link",3,"href",4,"ngIf"],[1,"btn","btn-primary","mt-2",3,"click","disabled"],[1,"badge","badge-success","position-absolute","top-0","start-0","m-2"],[1,"img-fluid","rounded","shadow-sm",3,"src","alt"],["controls","",1,"mt-2","rounded","shadow-sm",3,"src"],["target","_blank",1,"btn","btn-link",3,"href"],[1,"alert","alert-success","text-center","alert-confirmation","fixed-center"],[1,"alert","alert-danger","text-center","alert-confirmation","fixed-center"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"h2",1),c(2," Gestor de Noticias - Publicaciones de Instagram "),a(),r(3,"div",2)(4,"button",3),d("click",function(){return i.goBack()}),c(5," \u2190 Volver al Gestor de Noticias "),a(),r(6,"button",4),d("click",function(){return i.loadFirstPage()}),c(7," Recargar Publicaciones "),a()(),r(8,"div",5)(9,"h4",6),c(10," Crear Noticias Autom\xE1ticas "),a(),r(11,"div",7)(12,"button",8),d("click",function(){return i.createAutomaticNews("image")}),c(13," Crear Noticia Autom\xE1tica de Imagen "),a(),r(14,"button",9),d("click",function(){return i.createAutomaticNews("video")}),c(15," Crear Noticia Autom\xE1tica de Video "),a()()(),r(16,"div",10)(17,"div",11),g(18,B,2,0,"button",12),r(19,"span",13),c(20),a(),g(21,L,2,0,"button",12),a()(),g(22,$,4,0,"div",14)(23,U,2,1,"div",15)(24,Y,2,1,"div",16)(25,W,2,1,"div",17),r(26,"div",18)(27,"div",11),g(28,H,2,0,"button",12),r(29,"span",13),c(30),a(),g(31,J,2,0,"button",12),a()()()),e&2&&(s(18),l("ngIf",i.paging.before),s(2),_("P\xE1gina ",i.currentPage,""),s(),l("ngIf",i.paging.after),s(),l("ngIf",i.isLoading),s(),l("ngIf",!i.isLoading&&i.posts.length>0),s(),l("ngIf",i.successMessage),s(),l("ngIf",i.errorMessage),s(3),l("ngIf",i.paging.before),s(2),_("P\xE1gina ",i.currentPage,""),s(),l("ngIf",i.paging.after))},dependencies:[S,N,O,k,T],styles:['@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Light.ttf) format("truetype");font-weight:300;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-LightItalic.ttf) format("truetype");font-weight:300;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Black.ttf) format("truetype");font-weight:900;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BlackItalic.ttf) format("truetype");font-weight:900;font-style:italic}*[_ngcontent-%COMP%]{font-family:Merriweather}.container-fluid[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:20px}body[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]{font-family:Merriweather}.text-primary[_ngcontent-%COMP%]{font-family:Merriweather;font-size:2rem;color:#1a1a1a;font-weight:700;margin-bottom:20px;text-align:center}.dropdown-button[_ngcontent-%COMP%]{background:transparent;border:none;font-size:1.5rem;color:#1a1a1a;cursor:pointer;z-index:10;position:absolute;top:10px;right:10px;padding:0}.dropdown-button[_ngcontent-%COMP%]:hover{color:#ffb800}.instructions-popup[_ngcontent-%COMP%]{font-family:Merriweather;background-color:#fff;padding:10px;border-radius:8px;box-shadow:0 2px 6px #00000026;position:absolute;top:40px;right:10px;width:200px;font-size:.9rem;z-index:5}.btn[_ngcontent-%COMP%]{font-family:Merriweather;padding:10px 20px;font-size:1rem;border-radius:8px;border:2px solid #FFB800;cursor:pointer;transition:transform .3s ease,box-shadow .3s ease,background-color .3s ease,color .3s ease;background-color:#fff;color:#1a1a1a;display:inline-block;margin:10px 5px}.btn[_ngcontent-%COMP%]:hover{background-color:#ffb800;color:#fff;box-shadow:0 4px 10px #0003}.btn-primary[_ngcontent-%COMP%], .btn-info[_ngcontent-%COMP%], .btn-success[_ngcontent-%COMP%], .btn-danger[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%], .btn-link[_ngcontent-%COMP%]{font-family:Merriweather;background-color:#fff;color:#1a1a1a;border:2px solid #FFB800}.btn-primary[_ngcontent-%COMP%]:hover, .btn-info[_ngcontent-%COMP%]:hover, .btn-success[_ngcontent-%COMP%]:hover, .btn-danger[_ngcontent-%COMP%]:hover, .btn-secondary[_ngcontent-%COMP%]:hover{font-family:Merriweather;background-color:#ffb800;color:#fff}.pagination-controls[_ngcontent-%COMP%]{margin-top:20px}.pagination-buttons[_ngcontent-%COMP%]{font-family:Merriweather;display:flex;justify-content:center;align-items:center}.current-page[_ngcontent-%COMP%]{font-family:Merriweather;margin:0 10px;font-weight:700}.loading-indicator[_ngcontent-%COMP%]{font-family:Merriweather;text-align:center;font-size:18px;margin-top:20px}.active-post[_ngcontent-%COMP%]{border:3px solid #ffb800!important;background-color:#fff3cd!important}.automatic-post[_ngcontent-%COMP%]{border:3px solid #17a2b8!important;background-color:#fff3cd!important}.badge-success[_ngcontent-%COMP%]{background-color:#ffb800;color:#fff;padding:5px 10px;border-radius:8px;font-size:.8rem}.badge[_ngcontent-%COMP%]{display:inline-block;padding:5px 8px;border-radius:12px;font-size:12px;color:#fff;margin-right:5px}.badge-info[_ngcontent-%COMP%]{background-color:#17a2b8;color:#fff;padding:5px 10px;border-radius:8px;font-size:.8rem}.news-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:30px;margin-top:40px}.news-item[_ngcontent-%COMP%]{font-family:Merriweather;background-color:#fff;padding:8px 20px;border-radius:10px;box-shadow:0 4px 12px #0000001a;border:3px solid #FFB800;transition:transform .3s ease,box-shadow .3s ease,background-color .3s ease;display:flex;flex-direction:column;justify-content:space-between;overflow:hidden;height:100%;position:relative}.news-item[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 20px #00000026}.status-indicators[_ngcontent-%COMP%]{font-family:Merriweather;position:absolute;top:10px;left:10px}.media-container[_ngcontent-%COMP%]{position:relative;width:100%;height:250px;margin-bottom:15px}.media-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .media-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);max-height:100%;max-width:100%;object-fit:contain}.alert-confirmation[_ngcontent-%COMP%]{font-family:Merriweather;position:fixed;top:10%;left:50%;transform:translate(-50%);max-width:80%;padding:15px 20px;z-index:1050;font-size:1.2rem;font-weight:700;box-shadow:0 4px 8px #0003;border-radius:8px;animation:_ngcontent-%COMP%_slideDown .5s ease-in-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translate(-50%,-50%)}to{opacity:1;transform:translate(-50%)}}.alert-success[_ngcontent-%COMP%]{background-color:#43b02a;color:#fff;border:1px solid #FFB800}.alert-danger[_ngcontent-%COMP%]{background-color:#666;color:#fff;border:1px solid #FFB800}.mt-2[_ngcontent-%COMP%]{margin-top:10px}.mt-3[_ngcontent-%COMP%]{margin-top:15px}.mt-4[_ngcontent-%COMP%]{margin-top:20px}.text-center[_ngcontent-%COMP%]{font-family:Merriweather;text-align:center}.text-secondary[_ngcontent-%COMP%]{font-family:Merriweather;color:#6c757d}']})};export{V as NewsInstagramComponent};
