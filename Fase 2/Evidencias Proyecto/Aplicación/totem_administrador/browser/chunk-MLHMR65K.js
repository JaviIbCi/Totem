import{a as ie,b as ye,c as xe,d as ve,e as we}from"./chunk-OVRQ3KRF.js";import"./chunk-MUGV4U4L.js";import{a as ue}from"./chunk-NRKFFC3A.js";import{b as X,d as Z,e as _e,f as Ce,g as ee,h as be,i as fe,p as he,t as A}from"./chunk-DQGBAIQE.js";import{a as f,c as pe,i as J,k as K,m as N,n as me}from"./chunk-X2DCTIRQ.js";import{Ab as c,Bb as I,Cb as M,Db as q,Eb as y,F as b,Fb as x,Gb as v,Ia as D,Ib as V,Ka as d,La as w,Y as le,Ya as _,Z as z,Zb as Q,a as R,ab as u,b as U,ba as re,cb as se,ga as T,ha as L,hb as i,ib as n,jb as E,kb as ce,lb as de,mb as h,ob as m,oc as Y,pa as g,qa as p,qb as s,rc as O,sc as P,tb as ge,ub as ae,wb as W,wc as k,xb as j,yb as H}from"./chunk-INDI3DVQ.js";var S=class l{constructor(t,e){this.http=t;this.renewService=e}updateImageName(t,e){throw new Error("Method not implemented.")}getImagesByCategory(t){throw new Error("Method not implemented.")}apiUrl=me.apiUrl;getAllCollaborators(){let t=localStorage.getItem("accessToken"),e=new f({Authorization:`Bearer ${t}`});return this.http.get(`${this.apiUrl}collaborators/collaborators`,{headers:e}).pipe(b(r=>this.renewService.handleTokenError(r,()=>this.getAllCollaborators())))}getCollaboratorsByCategory(t,e){let r=localStorage.getItem("accessToken"),o=new f({Authorization:`Bearer ${r}`});return this.http.get(`${this.apiUrl}collaborators/collaborators/category/${t}`,{headers:o}).pipe(b(a=>this.renewService.handleTokenError(a,()=>this.getCollaboratorsByCategory(t))))}getCollaboratorById(t){let e=localStorage.getItem("accessToken"),r=new f({Authorization:`Bearer ${e}`});return this.http.get(`${this.apiUrl}collaborators/collaborators/${t}`,{headers:r}).pipe(b(o=>this.renewService.handleTokenError(o,()=>this.getCollaboratorById(t))))}createCollaborator(t,e){let r=localStorage.getItem("accessToken"),o=new f({Authorization:`Bearer ${r}`}),a=new FormData;return a.append("first_name",t.first_name),a.append("last_name",t.last_name),a.append("role",t.role),a.append("email",t.email),a.append("id_category",t.id_category.toString()),e&&a.append("image",e),this.http.post(`${this.apiUrl}collaborators/collaborators`,a,{headers:o}).pipe(b(C=>this.renewService.handleTokenError(C,()=>this.createCollaborator(t,e))))}updateCollaborator(t,e,r){let o=localStorage.getItem("accessToken"),a=new f({Authorization:`Bearer ${o}`,"Content-Type":"application/json"});return this.http.put(`${this.apiUrl}collaborators/collaborators/${t}`,e,{headers:a}).pipe(b(C=>this.renewService.handleTokenError(C,()=>this.updateCollaborator(t,e))))}toggleCollaboratorStatus(t,e){let r=localStorage.getItem("accessToken"),o=new f({Authorization:`Bearer ${r}`,"Content-Type":"application/json"}),a={id_category:e};return this.http.patch(`${this.apiUrl}collaborators/collaborators/${t}/toggle-status`,a,{headers:o}).pipe(b(C=>this.renewService.handleTokenError(C,()=>this.toggleCollaboratorStatus(t,e))))}deleteCollaborator(t,e){let r=localStorage.getItem("accessToken"),o=new f({Authorization:`Bearer ${r}`,"Content-Type":"application/json"}),a={id_category:e};return this.http.delete(`${this.apiUrl}collaborators/collaborators/${t}`,{headers:o,body:a}).pipe(b(C=>this.renewService.handleTokenError(C,()=>this.deleteCollaborator(t,e))))}updateCollaboratorImage(t,e,r){let o=localStorage.getItem("accessToken"),a=new f({Authorization:`Bearer ${o}`}),C=new FormData;return C.append("id_category",e.toString()),r&&C.append("image",r),this.http.put(`${this.apiUrl}collaborators/image/collaborators/${t}`,C,{headers:a}).pipe(b(oe=>this.renewService.handleTokenError(oe,()=>this.updateCollaboratorImage(t,e,r))))}getAllCollaboratorCategories(){let t=localStorage.getItem("accessToken"),e=new f({Authorization:`Bearer ${t}`});return this.http.get(`${this.apiUrl}collaborators/collaborator-categories`,{headers:e}).pipe(b(r=>this.renewService.handleTokenError(r,()=>this.getAllCollaboratorCategories())))}createCollaboratorCategory(t){let e=localStorage.getItem("accessToken"),r=new f({Authorization:`Bearer ${e}`,"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}collaborators/collaborator-categories`,t,{headers:r}).pipe(b(o=>this.renewService.handleTokenError(o,()=>this.createCollaboratorCategory(t))))}updateCollaboratorCategory(t,e){let r=localStorage.getItem("accessToken"),o=new f({Authorization:`Bearer ${r}`,"Content-Type":"application/json"});return this.http.put(`${this.apiUrl}collaborators/collaborator-categories/name/${t}`,e,{headers:o}).pipe(b(a=>this.renewService.handleTokenError(a,()=>this.updateCollaboratorCategory(t,e))))}deleteCollaboratorCategory(t){let e=localStorage.getItem("accessToken"),r=new f({Authorization:`Bearer ${e}`});return this.http.delete(`${this.apiUrl}collaborators/collaborator-categories/${t}`,{headers:r}).pipe(b(o=>this.renewService.handleTokenError(o,()=>this.deleteCollaboratorCategory(t))))}reorderCollaboratorCategories(t){let e=localStorage.getItem("accessToken"),r=new f({Authorization:`Bearer ${e}`,"Content-Type":"application/json"});return this.http.put(`${this.apiUrl}collaborators/collaborator-categories/reorder`,t,{headers:r}).pipe(b(o=>this.renewService.handleTokenError(o,()=>this.reorderCollaboratorCategories(t))))}getAllCollaboratorGroupCategories(){let t=localStorage.getItem("accessToken"),e=new f({Authorization:`Bearer ${t}`});return this.http.get(`${this.apiUrl}collaborators/collaborator-group-categories`,{headers:e}).pipe(b(r=>this.renewService.handleTokenError(r,()=>this.getAllCollaboratorGroupCategories())))}createCollaboratorGroupCategory(t){let e=localStorage.getItem("accessToken"),r=new f({Authorization:`Bearer ${e}`,"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}collaborators/collaborator-group-categories`,t,{headers:r}).pipe(b(o=>this.renewService.handleTokenError(o,()=>this.createCollaboratorGroupCategory(t))))}updateCollaboratorGroupCategory(t,e){let r=localStorage.getItem("accessToken"),o=new f({Authorization:`Bearer ${r}`,"Content-Type":"application/json"});return this.http.put(`${this.apiUrl}collaborators/collaborator-group-categories/name/${t}`,e,{headers:o}).pipe(b(a=>this.renewService.handleTokenError(a,()=>this.updateCollaboratorGroupCategory(t,e))))}deleteCollaboratorGroupCategory(t){let e=localStorage.getItem("accessToken"),r=new f({Authorization:`Bearer ${e}`});return this.http.delete(`${this.apiUrl}collaborators/collaborator-group-categories/${t}`,{headers:r}).pipe(b(o=>this.renewService.handleTokenError(o,()=>this.deleteCollaboratorGroupCategory(t))))}reorderCollaboratorGroupCategories(t){let e=localStorage.getItem("accessToken"),r=new f({Authorization:`Bearer ${e}`,"Content-Type":"application/json"});return this.http.put(`${this.apiUrl}collaborators/collaborator-group-categories/reorder`,t,{headers:r}).pipe(b(o=>this.renewService.handleTokenError(o,()=>this.reorderCollaboratorGroupCategories(t))))}getUnassignedCollaboratorImages(){let t=localStorage.getItem("accessToken"),e=new f({Authorization:`Bearer ${t}`});return this.http.get(`${this.apiUrl}collaborators/image/collaborators/unassigned`,{headers:e}).pipe(b(r=>this.renewService.handleTokenError(r,()=>this.getUnassignedCollaboratorImages())))}uploadMultipleImages(t){let e=localStorage.getItem("accessToken"),r=new f({Authorization:`Bearer ${e}`}),o=new FormData;return t.forEach((a,C)=>{o.append("images",a)}),this.http.post(`${this.apiUrl}collaborators/image/collaborators/batch-upload`,o,{headers:r}).pipe(b(a=>this.renewService.handleTokenError(a,()=>this.uploadMultipleImages(t))))}assignImagesToCollaborators(t){let e=localStorage.getItem("accessToken"),r=new f({Authorization:`Bearer ${e}`,"Content-Type":"application/json"}),o={assignments:t};return this.http.post(`${this.apiUrl}collaborators/image/collaborators/assign`,o,{headers:r}).pipe(b(a=>this.renewService.handleTokenError(a,()=>this.assignImagesToCollaborators(t))))}syncCollaboratorImages(){let t=localStorage.getItem("accessToken"),e=new f({Authorization:`Bearer ${t}`});return this.http.delete(`${this.apiUrl}collaborators/image/collaborators/sync`,{headers:e}).pipe(b(r=>this.renewService.handleTokenError(r,()=>this.syncCollaboratorImages())))}deleteAllUnassignedImages(t){let e=localStorage.getItem("accessToken"),r=new f({Authorization:`Bearer ${e}`});return this.http.delete(`${this.apiUrl}collaborators/image/collaborators/unassigned`,{headers:r}).pipe(b(o=>this.renewService.handleTokenError(o,()=>this.deleteAllUnassignedImages())))}downloadAllCollaborators(){let t=localStorage.getItem("accessToken"),e=new f({Authorization:`Bearer ${t}`});return this.http.get(`${this.apiUrl}collaborators/sheet/collaborators/download-all`,{headers:e,responseType:"blob"}).pipe(b(r=>this.renewService.handleTokenError(r,()=>this.downloadAllCollaborators())))}uploadAllCollaborators(t){let e=localStorage.getItem("accessToken"),r=new f({Authorization:`Bearer ${e}`}),o=new FormData;return t&&o.append("file",t),console.log("archivo:",t),this.http.post(`${this.apiUrl}collaborators/sheet/collaborators/upload-all`,o,{headers:r}).pipe(b(a=>(console.log(a),this.renewService.handleTokenError(a,()=>this.uploadAllCollaborators(t)))))}downloadCollaboratorsByCategory(t){let e=localStorage.getItem("accessToken"),r=new f({Authorization:`Bearer ${e}`,"Content-Type":"application/json"}),o={id_category:t};return this.http.post(`${this.apiUrl}collaborators/sheet/collaborators/category/download-excel`,o,{headers:r,responseType:"blob"}).pipe(b(a=>this.renewService.handleTokenError(a,()=>this.downloadCollaboratorsByCategory(t))))}uploadCollaboratorsByCategory(t,e){let r=localStorage.getItem("accessToken"),o=new f({Authorization:`Bearer ${r}`}),a=new FormData;return a.append("id_category",t.toString()),a.append("file",e),this.http.post(`${this.apiUrl}collaborators/sheet/collaborators/category/upload-excel`,a,{headers:o}).pipe(b(C=>this.renewService.handleTokenError(C,()=>this.uploadCollaboratorsByCategory(t,e))))}static \u0275fac=function(e){return new(e||l)(re(pe),re(ue))};static \u0275prov=le({token:l,factory:l.\u0275fac,providedIn:"root"})};var Te=["fileInput"];function De(l,t){if(l&1){let e=h();i(0,"div",12)(1,"div",13)(2,"h2"),c(3,"Subir Archivo de Colaboradores"),n(),i(4,"input",14),m("change",function(o){g(e);let a=s();return p(a.onExcelFileSelected(o))}),n(),i(5,"button",15),m("click",function(){g(e);let o=s();return p(o.confirmUpload())}),c(6,"Subir archivo"),n(),i(7,"button",15),m("click",function(){g(e);let o=s();return p(o.closeExcelModal())}),c(8,"Cancelar \u274C"),n()()()}}function Ve(l,t){if(l&1&&(i(0,"div",16),c(1),n()),l&2){let e=s();d(),M(" ",e.successMessage,`
`)}}function Oe(l,t){if(l&1&&(i(0,"p",22),c(1),n()),l&2){let e=s(2);d(),I(e.errorMessage)}}function Pe(l,t){if(l&1){let e=h();i(0,"div",12)(1,"div",13)(2,"h3"),c(3,"Agregar Nuevo Grupo de Categor\xEDa"),n(),i(4,"input",17),v("ngModelChange",function(o){g(e);let a=s();return x(a.newGroupCategory.name,o)||(a.newGroupCategory.name=o),p(o)}),n(),i(5,"div",18)(6,"label")(7,"input",19),v("ngModelChange",function(o){g(e);let a=s();return x(a.newGroupCategory.type,o)||(a.newGroupCategory.type=o),p(o)}),n(),c(8," Administrativo "),n(),i(9,"label")(10,"input",19),v("ngModelChange",function(o){g(e);let a=s();return x(a.newGroupCategory.type,o)||(a.newGroupCategory.type=o),p(o)}),n(),c(11," Docente "),n()(),_(12,Oe,2,1,"p",20),i(13,"button",21),m("click",function(){g(e);let o=s();return p(o.saveNewGroupCategory())}),c(14,"Guardar \u{1F4BE}"),n(),i(15,"button",21),m("click",function(){g(e);let o=s();return p(o.cancelAddingGroup())}),c(16,"Cancelar \u274C"),n()()()}if(l&2){let e=s();d(4),y("ngModel",e.newGroupCategory.name),d(3),y("ngModel",e.newGroupCategory.type),u("value",!0),d(3),y("ngModel",e.newGroupCategory.type),u("value",!1),d(2),u("ngIf",e.errorMessage)}}function Ae(l,t){if(l&1&&(i(0,"p",22),c(1),n()),l&2){let e=s(4);d(),I(e.errorMessage)}}function Ge(l,t){if(l&1){let e=h();i(0,"div",12)(1,"div",13)(2,"h3"),c(3,"Editar Categor\xEDa de Grupo"),n(),i(4,"input",33),v("ngModelChange",function(o){g(e);let a=s(3);return x(a.editGroupCategoryData.name,o)||(a.editGroupCategoryData.name=o),p(o)}),n(),_(5,Ae,2,1,"p",20),i(6,"button",1),m("click",function(){g(e);let o=s(3);return p(o.updateGroupCategory())}),c(7,"Guardar \u{1F4BE}"),n(),i(8,"button",1),m("click",function(){g(e);let o=s(3);return p(o.closeEditModal())}),c(9,"Cancelar \u274C"),n()()()}if(l&2){let e=s(3);d(4),y("ngModel",e.editGroupCategoryData.name),d(),u("ngIf",e.errorMessage)}}function Fe(l,t){if(l&1&&(i(0,"p",22),c(1),n()),l&2){let e=s(4);d(),I(e.errorMessage)}}function Be(l,t){if(l&1){let e=h();i(0,"div",12)(1,"div",13)(2,"h5"),c(3),n(),i(4,"input",17),v("ngModelChange",function(o){g(e);let a=s(3);return x(a.newCategory.name,o)||(a.newCategory.name=o),p(o)}),n(),_(5,Fe,2,1,"p",20),i(6,"button",1),m("click",function(){g(e);let o=s(3);return p(o.saveNewCategory())}),c(7,"Guardar \u{1F4BE}"),n(),i(8,"button",1),m("click",function(){g(e);let o=s(3);return p(o.closeAddCategoryModal())}),c(9,"Cancelar \u274C"),n()()()}if(l&2){let e=s(2).$implicit,r=s();d(3),M(" Agregar Nueva Categor\xEDa a ",e.group_category_name," "),d(),y("ngModel",r.newCategory.name),d(),u("ngIf",r.errorMessage)}}function Re(l,t){if(l&1&&(i(0,"p",22),c(1),n()),l&2){let e=s(5);d(),M(" ",e.errorMessage," ")}}function Ne(l,t){if(l&1){let e=h();i(0,"div",12)(1,"div",13)(2,"h3"),c(3,"Editar Nombre de la Categor\xEDa"),n(),i(4,"input",36),v("ngModelChange",function(o){g(e);let a=s(4);return x(a.editCategoryData.name,o)||(a.editCategoryData.name=o),p(o)}),n(),_(5,Re,2,1,"p",20),i(6,"button",1),m("click",function(){g(e);let o=s(4);return p(o.saveCategoryChanges())}),c(7," Guardar \u{1F4BE} "),n(),i(8,"button",1),m("click",function(){g(e);let o=s(4);return p(o.closeEditCategoryModal())}),c(9," Cancelar \u274C "),n()()()}if(l&2){let e=s().$implicit,r=s(3);d(4),ae("id","editCategoryName-",e.id_collaborator_category,""),y("ngModel",r.editCategoryData.name),d(),u("ngIf",r.errorMessage)}}function $e(l,t){if(l&1){let e=h();i(0,"div",34),m("cdkDropListDropped",function(o){g(e);let a=s(3);return p(a.dropCategory(o))}),i(1,"h3"),c(2),n(),i(3,"div",35)(4,"button",1),m("click",function(){let o=g(e).$implicit,a=s(3);return p(a.navigateToCollaborators(o.id_collaborator_category))}),c(5," Colaboradores \u{1F465} "),n(),i(6,"button",1),m("click",function(){let o=g(e).$implicit,a=s(3);return p(a.openEditCategoryModal(o))}),c(7," Editar \u270F\uFE0F "),n(),i(8,"button",30),m("click",function(){let o=g(e).$implicit,a=s(3);return p(a.deleteCategory(o.id_collaborator_category))}),c(9," Eliminar \u{1F5D1}\uFE0F "),n(),_(10,Ne,10,4,"div",2),n()()}if(l&2){let e=t.$implicit,r=s(3);d(2),M(" ",e.collaborator_category_name||"Sin nombre"," "),d(8),u("ngIf",r.editingCategoryId===e.id_collaborator_category)}}function Ue(l,t){l&1&&(i(0,"p"),c(1," No hay categor\xEDas en este grupo. "),n())}function ze(l,t){if(l&1){let e=h();ce(0),i(1,"div",25)(2,"div",26)(3,"div",27)(4,"h2")(5,"span",28),c(6,"\u22EE"),n(),c(7),n()(),i(8,"div",29)(9,"button",1),m("click",function(){g(e);let o=s().$implicit,a=s();return p(a.openEditModal(o.id_group_category))}),c(10," Editar \u270F\uFE0F "),n(),i(11,"button",1),m("click",function(){g(e);let o=s().$implicit,a=s();return p(a.openAddCategoryModal(o.id_group_category))}),c(12," Agregar Categor\xEDa \u2795 "),n(),i(13,"button",30),m("click",function(){g(e);let o=s().$implicit,a=s();return p(a.prepareDeleteGroupCategory(o.id_group_category))}),c(14," Eliminar \u{1F5D1}\uFE0F "),n()(),_(15,Ge,10,2,"div",2)(16,Be,10,3,"div",2),i(17,"div",31),_(18,$e,11,2,"div",32)(19,Ue,2,0,"p",24),n()()(),de()}if(l&2){let e=s().$implicit,r=s();d(7),M(" ",e.group_category_name," "),d(8),u("ngIf",r.isEditingGroupCategory&&r.selectedGroupCategoryId===e.id_group_category),d(),u("ngIf",r.isAddingCategory&&r.selectedGroupCategoryId===e.id_group_category),d(2),u("ngForOf",r.getCategoriesByGroupId(e.id_group_category)),d(),u("ngIf",r.getCategoriesByGroupId(e.id_group_category).length===0)}}function Le(l,t){if(l&1&&(i(0,"div",23),_(1,ze,20,5,"ng-container",24),n()),l&2){let e=t.$implicit;d(),u("ngIf",!e.is_administrative)}}function We(l,t){if(l&1&&(i(0,"p",22),c(1),n()),l&2){let e=s(4);d(),I(e.errorMessage)}}function je(l,t){if(l&1){let e=h();i(0,"div",12)(1,"div",13)(2,"h3"),c(3,"Editar Categor\xEDa de Grupo"),n(),i(4,"input",33),v("ngModelChange",function(o){g(e);let a=s(3);return x(a.editGroupCategoryData.name,o)||(a.editGroupCategoryData.name=o),p(o)}),n(),_(5,We,2,1,"p",20),i(6,"button",1),m("click",function(){g(e);let o=s(3);return p(o.updateGroupCategory())}),c(7,"Guardar \u{1F4BE}"),n(),i(8,"button",1),m("click",function(){g(e);let o=s(3);return p(o.closeEditModal())}),c(9,"Cancelar \u274C"),n()()()}if(l&2){let e=s(3);d(4),y("ngModel",e.editGroupCategoryData.name),d(),u("ngIf",e.errorMessage)}}function He(l,t){if(l&1&&(i(0,"p",22),c(1),n()),l&2){let e=s(4);d(),I(e.errorMessage)}}function qe(l,t){if(l&1){let e=h();i(0,"div",12)(1,"div",13)(2,"h5"),c(3),n(),i(4,"input",17),v("ngModelChange",function(o){g(e);let a=s(3);return x(a.newCategory.name,o)||(a.newCategory.name=o),p(o)}),n(),_(5,He,2,1,"p",20),i(6,"button",1),m("click",function(){g(e);let o=s(3);return p(o.saveNewCategory())}),c(7,"Guardar \u{1F4BE}"),n(),i(8,"button",1),m("click",function(){g(e);let o=s(3);return p(o.closeAddCategoryModal())}),c(9,"Cancelar \u274C"),n()()()}if(l&2){let e=s(2).$implicit,r=s();d(3),M(" Agregar Nueva Categor\xEDa a ",e.group_category_name," "),d(),y("ngModel",r.newCategory.name),d(),u("ngIf",r.errorMessage)}}function Qe(l,t){if(l&1&&(i(0,"p",22),c(1),n()),l&2){let e=s(5);d(),I(e.errorMessage)}}function Ye(l,t){if(l&1){let e=h();i(0,"div",12)(1,"div",13)(2,"h3"),c(3,"Editar Nombre de la Categor\xEDa"),n(),i(4,"input",36),v("ngModelChange",function(o){g(e);let a=s(4);return x(a.editCategoryData.name,o)||(a.editCategoryData.name=o),p(o)}),n(),_(5,Qe,2,1,"p",20),i(6,"button",1),m("click",function(){g(e);let o=s(4);return p(o.saveCategoryChanges())}),c(7,"Guardar \u{1F4BE}"),n(),i(8,"button",1),m("click",function(){g(e);let o=s(4);return p(o.closeEditCategoryModal())}),c(9," Cancelar\u274C "),n()()()}if(l&2){let e=s().$implicit,r=s(3);d(4),ae("id","editCategoryName-",e.id_collaborator_category,""),y("ngModel",r.editCategoryData.name),d(),u("ngIf",r.errorMessage)}}function Je(l,t){if(l&1){let e=h();i(0,"div",42),m("cdkDropListDropped",function(o){g(e);let a=s(3);return p(a.dropCategory(o))}),i(1,"span")(2,"h3"),c(3),n()(),i(4,"div",35)(5,"button",1),m("click",function(){let o=g(e).$implicit,a=s(3);return p(a.navigateToCollaborators(o.id_collaborator_category))}),c(6," Colaboradores \u{1F465} "),n(),i(7,"button",1),m("click",function(){let o=g(e).$implicit,a=s(3);return p(a.openEditCategoryModal(o))}),c(8," Editar \u270F\uFE0F "),n(),i(9,"button",30),m("click",function(){let o=g(e).$implicit,a=s(3);return p(a.deleteCategory(o.id_collaborator_category))}),c(10," Eliminar \u{1F5D1}\uFE0F "),n(),_(11,Ye,10,4,"div",2),n()()}if(l&2){let e=t.$implicit,r=s(3);d(3),M(" ",e.collaborator_category_name||"Sin nombre"," "),d(8),u("ngIf",r.editingCategoryId===e.id_collaborator_category)}}function Ke(l,t){l&1&&(i(0,"p"),c(1," No hay categor\xEDas en este grupo. "),n())}function Xe(l,t){if(l&1){let e=h();i(0,"div")(1,"div",26)(2,"h2")(3,"div",38)(4,"span",28),c(5,"\u22EE"),n(),c(6),n()(),E(7,"br"),i(8,"div",39)(9,"button",1),m("click",function(){g(e);let o=s().$implicit,a=s();return p(a.openEditModal(o.id_group_category))}),c(10," Editar \u270F\uFE0F "),n(),_(11,je,10,2,"div",2),i(12,"button",1),m("click",function(){g(e);let o=s().$implicit,a=s();return p(a.openAddCategoryModal(o.id_group_category))}),c(13," Agregar Categor\xEDa \u2795 "),n(),_(14,qe,10,3,"div",2),i(15,"button",30),m("click",function(){g(e);let o=s().$implicit,a=s();return p(a.prepareDeleteGroupCategory(o.id_group_category))}),c(16," Eliminar \u{1F5D1}\uFE0F "),n()(),i(17,"div",40),_(18,Je,12,2,"div",41)(19,Ke,2,0,"p",24),n()()()}if(l&2){let e=s().$implicit,r=s();d(6),M(" ",e.group_category_name," > "),d(5),u("ngIf",r.isEditingGroupCategory&&r.selectedGroupCategoryId===e.id_group_category),d(3),u("ngIf",r.isAddingCategory&&r.selectedGroupCategoryId===e.id_group_category),d(4),u("ngForOf",r.getCategoriesByGroupId(e.id_group_category)),d(),u("ngIf",r.getCategoriesByGroupId(e.id_group_category).length===0)}}function Ze(l,t){if(l&1&&(i(0,"div",37),_(1,Xe,20,5,"div",24),n()),l&2){let e=t.$implicit;d(),u("ngIf",e.is_administrative)}}var G=class l{constructor(t,e){this.collaboratorService=t;this.router=e}groupCategories=[];categories=[];newGroupCategory={name:"",type:null};newCategory={name:""};isAddingGroupCategory=!1;isAddingCategory=!1;isDeletingGroupCategory=!1;isDeletingCategory=!1;groupCategoryIdToDelete=null;CategoryIdToDelete=null;categoryId=null;selectedGroupCategoryId=null;errorMessage="";isEditingGroupCategory=!1;editGroupCategoryData={name:""};editCategoryData={id:null,name:""};editingCategoryId=null;successMessage="";isModalOpen=!1;selectedCollaborator={first_name:"",last_name:"",email:"",role:"",imagepath:"",is_active:!1,id_category:null};existingCollaborators=[];fileInput;validatedCollaborators=[];duplicateRecords=[];ngOnInit(){this.loadGroupCategories(),this.loadCategories()}loadGroupCategories(){this.collaboratorService.getAllCollaboratorCategories().subscribe({next:t=>{t&&Array.isArray(t.groupCategories)?this.groupCategories=t.groupCategories:(console.error("El valor recibido no es un arreglo:",t),this.groupCategories=[])},error:t=>{console.error("Error al cargar categor\xEDas:",t),this.groupCategories=[]}})}loadCategories(){this.collaboratorService.getAllCollaboratorCategories().subscribe(t=>{let e=t.groupCategories||[];this.categories=e.reduce((r,o)=>{let a=(o.CollaboratorCategories||[]).map(C=>U(R({},C),{id_group_category:o.id_group_category,group_category_name:o.group_category_name,is_administrative:o.is_administrative}));return r.concat(a)},[])},t=>{console.error("Error al obtener las categor\xEDas:",t)})}getCategoriesByGroupId(t){return this.categories.filter(r=>r.id_group_category===t)||[]}openExcelModal(){this.isModalOpen=!0}closeExcelModal(){this.isModalOpen=!1}loadExistingCollaborators(){this.collaboratorService.getAllCollaborators().subscribe({next:t=>{this.existingCollaborators=t},error:t=>{console.error("Error al cargar colaboradores existentes:",t)}})}file=null;onExcelFileSelected(t){let e=t.target.files[0];e?this.file=e:console.warn("No se seleccion\xF3 ning\xFAn archivo.")}validateDuplicates(t){let e=new Set;this.validatedCollaborators=[],this.duplicateRecords=[],t.forEach(r=>{e.has(r.email)?this.duplicateRecords.push(r):(e.add(r.email),this.validatedCollaborators.push(r))}),this.duplicateRecords.length>0&&alert(`Se encontraron ${this.duplicateRecords.length} registros duplicados y fueron omitidos.`)}uploadValidatedCollaborators(){this.collaboratorService.uploadAllCollaborators(this.file).subscribe(t=>{},t=>{console.error("Error al obtener las categor\xEDas:",t)})}confirmUpload(){window.confirm("Subir este archivo eliminar\xE1 los datos existentes. \xBFEst\xE1s seguro de que deseas continuar?")&&this.uploadValidatedCollaborators()}confirmDownload(){window.confirm("\xBFEst\xE1s seguro de que deseas descargar el listado de colaboradores?")&&this.downloadCollaborators()}downloadCollaborators(){this.collaboratorService.downloadAllCollaborators().subscribe(t=>{let e=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=window.URL.createObjectURL(e),o=document.createElement("a");o.href=r,o.download="colaboradores.xlsx",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(r)},t=>{console.error("Error al obtener las categor\xEDas:",t)})}openModal(){this.isModalOpen=!0,this.selectedCollaborator={first_name:"",last_name:"",email:"",role:"",imagepath:"",is_active:!1,id_category:this.categoryId}}openAddCategoryModal(t){this.selectedGroupCategoryId=t,this.isAddingCategory=!0}addGroupCategory(){this.isAddingGroupCategory=!0,this.newGroupCategory={name:"",type:null}}addCategory(){this.isAddingCategory=!0}saveNewGroupCategory(){if(!this.newGroupCategory.name||this.newGroupCategory.name.trim().length<3){this.errorMessage="El nombre de la categor\xEDa debe tener al menos 3 caracteres.";return}if(this.newGroupCategory.type===null||this.newGroupCategory.type===void 0){this.errorMessage="Por favor, selecciona si la categor\xEDa es Administrativa o Docente.";return}let t={group_category_name:this.newGroupCategory.name.trim(),is_administrative:this.newGroupCategory.type?1:0};this.collaboratorService.createCollaboratorGroupCategory(t).subscribe({next:()=>{this.isAddingGroupCategory=!1,this.errorMessage="",this.loadGroupCategories()},error:e=>{e.status===400?e.error.message.includes("ya existe")?this.errorMessage="El nombre de la categor\xEDa ya existe. Elige otro.":this.errorMessage=e.error.message||"Error al crear la categor\xEDa de grupo":this.errorMessage="Error en el servidor al crear la categor\xEDa de grupo",console.error("Error:",e)}})}saveNewCategory(){if(!this.newCategory.name.trim()){this.errorMessage="El nombre de la categor\xEDa no puede estar vac\xEDo.";return}if(this.selectedGroupCategoryId===null){console.error("Error: No se ha seleccionado un grupo de categor\xEDa para asociar.");return}let t={collaborator_category_name:this.newCategory.name,id_group_category:this.selectedGroupCategoryId};this.collaboratorService.createCollaboratorCategory(t).subscribe(e=>{this.closeAddCategoryModal(),this.loadCategories()},e=>{console.error("Error al crear la nueva categor\xEDa:",e)})}closeAddCategoryModal(){this.isAddingCategory=!1,this.newCategory={name:""},this.selectedGroupCategoryId=null,this.errorMessage=""}openEditCategoryModal(t){this.editingCategoryId=t.id_collaborator_category,this.editCategoryData={id:t.id_collaborator_category,name:t.collaborator_category_name}}closeEditCategoryModal(){this.editingCategoryId=null,this.editCategoryData={id:null,name:""},this.errorMessage=""}saveCategoryChanges(){if(this.editCategoryData.id!==null&&this.editCategoryData.name.trim().length>=3){let t={collaborator_category_name:this.editCategoryData.name.trim()};this.collaboratorService.updateCollaboratorCategory(this.editCategoryData.id,t).subscribe({next:()=>{this.loadGroupCategories(),this.closeEditCategoryModal(),location.reload()},error:e=>{this.errorMessage="Error al actualizar la categor\xEDa",console.error("Error:",e)}})}else this.errorMessage="ID de categor\xEDa no v\xE1lido o nombre demasiado corto"}cancelAddingGroup(){this.isAddingGroupCategory=!1,this.errorMessage=""}cancelAdding(){this.isAddingCategory=!1,this.newCategory={name:""},this.errorMessage=""}prepareDeleteGroupCategory(t){window.confirm("\xBFEst\xE1s seguro de que deseas eliminar este grupo?")&&this.confirmDeleteGroupCategory(t)}confirmDeleteGroupCategory(t){this.collaboratorService.deleteCollaboratorGroupCategory(t).subscribe(()=>{this.loadGroupCategories()})}deleteCategory(t){confirm("\xBFEst\xE1s seguro de que deseas eliminar este grupo?")&&this.collaboratorService.deleteCollaboratorCategory(t).subscribe(e=>{this.loadCategories()},e=>{console.error("Error al eliminar :",e)})}cancelDeleteGroup(){this.isDeletingGroupCategory=!1,this.groupCategoryIdToDelete=null}cancelDelete(){this.isDeletingCategory=!1,this.CategoryIdToDelete=null}openEditModal(t){this.isEditingGroupCategory=!0,this.selectedGroupCategoryId=t;let e=this.groupCategories.find(r=>r.id_group_category===t);this.editGroupCategoryData={name:e?.group_category_name||""}}closeEditModal(){this.isEditingGroupCategory=!1,this.selectedGroupCategoryId=null,this.errorMessage=""}updateGroupCategory(){if(!this.selectedGroupCategoryId){this.errorMessage="ID de categor\xEDa de grupo inv\xE1lido.";return}if(!this.validateCategoryName(this.editGroupCategoryData.name))return;let t={group_category_name:this.editGroupCategoryData.name.trim()};this.collaboratorService.updateCollaboratorGroupCategory(this.selectedGroupCategoryId,t).subscribe({next:()=>{let e=this.groupCategories.find(r=>r.id_group_category===this.selectedGroupCategoryId);e&&(e.group_category_name=this.editGroupCategoryData.name),this.closeEditModal()},error:e=>{this.errorMessage="Error al actualizar la categor\xEDa",console.error("Error en la actualizaci\xF3n:",e)}})}validateCategoryName(t){return!t||t.trim().length<3?(this.errorMessage="El nombre de la categor\xEDa debe tener al menos 3 caracteres.",!1):!0}drop(t){ie(this.groupCategories,t.previousIndex,t.currentIndex);let e=this.groupCategories[t.currentIndex].is_administrative;this.updateGroupCategoryOrder(e)}updateGroupCategoryOrder(t){let r=this.groupCategories.filter(a=>a.is_administrative==t).map(a=>({id_group_category:a.id_group_category})),o={is_administrative:t,order:r};this.collaboratorService.reorderCollaboratorGroupCategories(o).subscribe(a=>{},a=>{console.error("Error al reordenar las categor\xEDas:",a)})}dropCategory(t){ie(this.categories,t.previousIndex,t.currentIndex);let e=this.categories[t.currentIndex].is_administrative;this.updateCategoryOrder(e)}updateCategoryOrder(t){let r=this.categories.filter(a=>a.is_administrative==t).map(a=>({id_category:a.id_category})),o={is_administrative:t,order:r};this.collaboratorService.reorderCollaboratorCategories(o).subscribe(a=>{},a=>{console.error("Error al reordenar las categor\xEDas:",a)})}navigateToCollaborators(t){this.router.navigate(["collaborator/index",t])}static \u0275fac=function(e){return new(e||l)(w(S),w(K))};static \u0275cmp=T({type:l,selectors:[["app-collaborator-categories"]],viewQuery:function(e,r){if(e&1&&W(Te,5),e&2){let o;j(o=H())&&(r.fileInput=o.first)}},standalone:!0,features:[V],decls:30,vars:5,consts:[[1,"title"],[3,"click"],["class","modal-overlay",4,"ngIf"],["class","success-message",4,"ngIf"],[1,"custom-line"],[1,"subtitle"],[1,"sub"],["cdkDropList","",1,"group-category-list",3,"cdkDropListDropped"],[1,"categories"],["class","group-category","cdkDrag","",4,"ngFor","ngForOf"],["cdkDropList","",1,"group-category-list","mat-no-styling",3,"cdkDropListDropped"],["class","group-category-item mat-no-styling","cdkDrag","",4,"ngFor","ngForOf"],[1,"modal-overlay"],[1,"modal-content"],["type","file","accept",".xlsx",3,"change"],[1,"upex",3,"click"],[1,"success-message"],["type","text","placeholder","Nombre de la categor\xEDa",3,"ngModelChange","ngModel"],[1,"select"],["type","radio","name","groupType",3,"ngModelChange","ngModel","value"],["class","error",4,"ngIf"],[1,"addg",3,"click"],[1,"error"],["cdkDrag","",1,"group-category"],[4,"ngIf"],["cdkDrag","",1,"group-category-item"],[1,"grupo"],[1,"handle"],["cdkDragHandle","",1,"drag-handle"],[1,"btn-gr"],[1,"delete",3,"click"],[1,"card"],["class","category-card","cdkDropList","",3,"cdkDropListDropped",4,"ngFor","ngForOf"],["type","text","placeholder","Nuevo nombre de la categor\xEDa",3,"ngModelChange","ngModel"],["cdkDropList","",1,"category-card",3,"cdkDropListDropped"],[1,"btn-cat"],["type","text","placeholder","Nuevo nombre de la categor\xEDa","name","editCategoryName",3,"ngModelChange","ngModel","id"],["cdkDrag","",1,"group-category-item","mat-no-styling"],[1,"handle","mat-no-styling"],[1,"btn-gr","mat-no-styling"],[1,"card","mat-no-styling"],["class","category-card mat-no-styling","cdkDropList","","cdkDrag","",3,"cdkDropListDropped",4,"ngFor","ngForOf"],["cdkDropList","","cdkDrag","",1,"category-card","mat-no-styling",3,"cdkDropListDropped"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"h1"),c(2,"Colaboradores"),n()(),i(3,"button",1),m("click",function(){return r.openExcelModal()}),c(4,"Subir colaboradores \u2B06\uFE0F"),n(),i(5,"button",1),m("click",function(){return r.confirmDownload()}),c(6,"Descargar listado de colaboradores \u2B07\uFE0F"),n(),i(7,"button",1),m("click",function(){return r.addGroupCategory()}),c(8,"Agregar Grupo \u2795"),n(),_(9,De,9,0,"div",2)(10,Ve,2,1,"div",3)(11,Pe,17,6,"div",2),E(12,"hr",4),i(13,"div",5)(14,"h2",6)(15,"strong"),c(16,"DOCENTES \u{1F4D2} "),n()()(),E(17,"hr",4),i(18,"div",7),m("cdkDropListDropped",function(a){return r.drop(a)}),i(19,"div",8),_(20,Le,2,1,"div",9),n()(),E(21,"hr",4),i(22,"div",5)(23,"h2",6)(24,"strong"),c(25,"ADMINISTRATIVOS \u{1F5C2}\uFE0F "),n()()(),E(26,"hr",4),i(27,"div",10),m("cdkDropListDropped",function(a){return r.drop(a)}),i(28,"div",8),_(29,Ze,2,1,"div",11),n()()),e&2&&(d(9),u("ngIf",r.isModalOpen),d(),u("ngIf",r.successMessage),d(),u("ngIf",r.isAddingGroupCategory),d(9),u("ngForOf",r.groupCategories),d(9),u("ngForOf",r.groupCategories))},dependencies:[A,X,fe,Z,ee,k,O,P,we,ve,xe,ye],styles:['@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Light.ttf) format("truetype");font-weight:300;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-LightItalic.ttf) format("truetype");font-weight:300;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Black.ttf) format("truetype");font-weight:900;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BlackItalic.ttf) format("truetype");font-weight:900;font-style:italic}*[_ngcontent-%COMP%]{font-family:Merriweather}.group-category-item[_ngcontent-%COMP%]{background-color:#fff;margin-bottom:1rem;border-radius:10px;border-width:2px}.group-category-list[_ngcontent-%COMP%]{border-radius:15px;background-color:none;border-width:2px;margin-bottom:1rem!important}.grupo[_ngcontent-%COMP%]{border-style:solid!important;border-color:#fbb414;border-radius:10px;border-width:2px}.title[_ngcontent-%COMP%]{background-color:#fff;border-radius:15px;border-style:solid!important;border-width:2px!important;border-radius:5px!important;border-color:#fbb414;margin-bottom:1rem}.card[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;border-width:2px;display:flex;flex-wrap:wrap;align-content:center!important;align-items:center!important}.category-card[_ngcontent-%COMP%]{margin-bottom:1rem;background-color:#fff;border-radius:10px;display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;border-width:2px!important;border-color:#fbb414!important;border-style:solid!important;width:500px;align-content:center!important;align-items:center!important;margin-right:0%!important;margin-left:3rem}.category-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 12px #0003}button[_ngcontent-%COMP%]{background-color:#fff;border-radius:5px;border-color:#fbb414;margin-right:0%!important}button[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 12px #0003}.delete[_ngcontent-%COMP%]{font-weight:700;background-color:#fff;border-color:#fbb414}.btn-cat[_ngcontent-%COMP%]{margin-right:1rem!important;margin-bottom:15px;display:flex;flex-wrap:wrap;gap:1rem;justify-content:flex-end;flex-direction:row;width:100%}.btn-gr[_ngcontent-%COMP%]{margin-left:10px;margin-bottom:1rem;display:flex;flex-wrap:wrap;gap:1rem;justify-content:flex-start;flex-direction:row}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%]{margin-left:10px;margin-top:10px}.subtitle[_ngcontent-%COMP%]{background-color:#fff;border-color:#fbb414!important;border-style:solid!important;border-radius:2px 10px;height:50px;vertical-align:middle;margin-top:1rem;margin-bottom:1rem;text-align:center}.drag-handle[_ngcontent-%COMP%]{cursor:grab;font-size:xx-large;margin-right:0;color:#fbb414;align-content:right;background-color:#fff;border-radius:5px}.drag-handle[_ngcontent-%COMP%]:hover{color:#000}.custom-line[_ngcontent-%COMP%]{border-radius:10px;border-top:10px solid;border-color:#fbb414;margin:20px 0;width:100%}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:10px;border-color:#fbb414!important;border-style:solid!important;border-width:2px!important;box-shadow:0 4px 8px #0003;width:400px;max-width:90%;text-align:center;font-size:larger}.upex[_ngcontent-%COMP%]{margin-left:5px!important;margin-top:5px!important}.select[_ngcontent-%COMP%]{margin-top:5px!important;margin-bottom:5px!important}.addg[_ngcontent-%COMP%]{margin-left:5px!important}']})};var et=["fileInput"];function tt(l,t){if(l&1){let e=h();i(0,"div")(1,"button",6),m("click",function(){g(e);let o=s();return p(o.navigateToImages(o.categoryId))}),c(2," Gestionar Im\xE1genes \u{1F5BC}\uFE0F "),n()()}}function ot(l,t){if(l&1){let e=h();i(0,"button",6),m("click",function(){g(e);let o=s();return p(o.uploadCollaboratorsByCategory())}),c(1," Subir Archivo Excel "),n()}}function rt(l,t){if(l&1){let e=h();i(0,"div",14)(1,"div",15)(2,"div",16)(3,"h2"),c(4,"Crear Colaborador"),n(),i(5,"button",17),m("click",function(){g(e);let o=s();return p(o.closeCreateModal())}),c(6," \u2716 "),n()(),i(7,"div",18)(8,"form",19),m("ngSubmit",function(){g(e);let o=s();return p(o.createCollaborator())}),i(9,"div",20)(10,"label",21),c(11,"Nombre"),n(),i(12,"input",22),v("ngModelChange",function(o){g(e);let a=s();return x(a.selectedCollaborator.first_name,o)||(a.selectedCollaborator.first_name=o),p(o)}),n()(),i(13,"div",20)(14,"label",23),c(15,"Apellido"),n(),i(16,"input",24),v("ngModelChange",function(o){g(e);let a=s();return x(a.selectedCollaborator.last_name,o)||(a.selectedCollaborator.last_name=o),p(o)}),n()(),i(17,"div",20)(18,"label",25),c(19,"Email"),n(),i(20,"input",26),v("ngModelChange",function(o){g(e);let a=s();return x(a.selectedCollaborator.email,o)||(a.selectedCollaborator.email=o),p(o)}),n()(),i(21,"div",20)(22,"label",27),c(23,"Rol"),n(),i(24,"input",28),v("ngModelChange",function(o){g(e);let a=s();return x(a.selectedCollaborator.role,o)||(a.selectedCollaborator.role=o),p(o)}),n()(),i(25,"div",20)(26,"label",29),c(27,"Imagen"),n(),i(28,"input",30),m("change",function(o){g(e);let a=s();return p(a.onImageSelected(o))}),n()(),i(29,"div",31)(30,"button",32),c(31," Crear Colaborador "),n(),i(32,"button",33),m("click",function(){g(e);let o=s();return p(o.closeCreateModal())}),c(33," Cancelar "),n()()()()()()}if(l&2){let e=s();d(12),y("ngModel",e.selectedCollaborator.first_name),d(4),y("ngModel",e.selectedCollaborator.last_name),d(4),y("ngModel",e.selectedCollaborator.email),d(4),y("ngModel",e.selectedCollaborator.role)}}function at(l,t){if(l&1&&(i(0,"div",48)(1,"p"),c(2,"Vista previa:"),n(),E(3,"img",49),n()),l&2){let e=s(2);d(3),u("src",e.imagePreview,D)}}function it(l,t){if(l&1){let e=h();i(0,"div",34)(1,"div",15)(2,"div",16)(3,"h2"),c(4,"Editar Colaborador"),n(),i(5,"button",17),m("click",function(){g(e);let o=s();return p(o.closeEditModal())}),c(6,"\u2716"),n()(),i(7,"div",18)(8,"form",19),m("ngSubmit",function(){g(e);let o=s();return p(o.updateCollaborator())}),i(9,"div",35)(10,"div",36)(11,"label",37),c(12,"Nombre"),n(),i(13,"input",38),v("ngModelChange",function(o){g(e);let a=s();return x(a.selectedCollaborator.first_name,o)||(a.selectedCollaborator.first_name=o),p(o)}),n()(),i(14,"div",36)(15,"label",39),c(16,"Apellido"),n(),i(17,"input",40),v("ngModelChange",function(o){g(e);let a=s();return x(a.selectedCollaborator.last_name,o)||(a.selectedCollaborator.last_name=o),p(o)}),n()()(),i(18,"div",35)(19,"div",36)(20,"label",41),c(21,"Email"),n(),i(22,"input",42),v("ngModelChange",function(o){g(e);let a=s();return x(a.selectedCollaborator.email,o)||(a.selectedCollaborator.email=o),p(o)}),n()(),i(23,"div",36)(24,"label",43),c(25,"Rol"),n(),i(26,"input",44),v("ngModelChange",function(o){g(e);let a=s();return x(a.selectedCollaborator.role,o)||(a.selectedCollaborator.role=o),p(o)}),n()()(),i(27,"div",36)(28,"label",45),c(29,"Imagen"),n(),i(30,"input",46),m("change",function(o){g(e);let a=s();return p(a.onImageSelected(o))}),n()(),_(31,at,4,1,"div",47),i(32,"div",31)(33,"button",32),c(34,"Guardar Cambios"),n(),i(35,"button",33),m("click",function(){g(e);let o=s();return p(o.closeEditModal())}),c(36," Cancelar "),n()()()()()()}if(l&2){let e=s();d(13),y("ngModel",e.selectedCollaborator.first_name),d(4),y("ngModel",e.selectedCollaborator.last_name),d(5),y("ngModel",e.selectedCollaborator.email),d(4),y("ngModel",e.selectedCollaborator.role),d(5),u("ngIf",e.imagePreview)}}function nt(l,t){if(l&1&&E(0,"img",57),l&2){let e=s().$implicit,r=s();u("src",r.getCollaboratorImageUrl(e),D)}}function lt(l,t){if(l&1){let e=h();i(0,"div",50)(1,"div",51),_(2,nt,1,1,"img",52),i(3,"p")(4,"strong"),c(5,"Nombre:"),n()(),i(6,"p",53),c(7),n(),i(8,"p")(9,"strong"),c(10,"Rol:"),n()(),i(11,"p",53),c(12),n(),i(13,"p")(14,"strong"),c(15,"Email:"),n()(),i(16,"p",54),c(17),n(),i(18,"div",55)(19,"button",56),m("click",function(){let o=g(e).$implicit,a=s();return p(a.openEditCollaboratorModal(o))}),c(20," Editar \u270F\uFE0F "),n(),i(21,"button",56),m("click",function(){let o=g(e).$implicit,a=s();return p(a.deleteCollaborator(o.id_collaborator,o.id_collaborator_category))}),c(22," Eliminar \u{1F5D1}\uFE0F "),n(),i(23,"button",56),m("click",function(){let o=g(e).$implicit,a=s();return p(a.toggleCollaboratorStatus(o.id_collaborator,o.id_collaborator_category))}),c(24),n()()()()}if(l&2){let e=t.$implicit;d(2),u("ngIf",e.image_path),d(5),q("",e.first_name," ",e.last_name,""),d(5),I(e.role),d(5),I(e.email),d(7),M(" ",e.is_active?"Desactivado \u{1F534}":"Activado \u{1F7E2}"," ")}}var F=class l{constructor(t,e,r,o,a){this.collaboratorService=t;this.router=e;this.location=r;this.route=o;this.cdr=a}fileInput;defaultCategoryId;apiURL;collaborator={};editingCollaborator=null;categories=[];selectedCollaborator={first_name:"",last_name:"",email:"",role:"",imagepath:"",is_active:!1,id_category:null};newCollaborator={first_name:"",last_name:"",email:"",role:"",id_category:null};groupCategoryId=null;filteredCollaborators=[];selectedImageFile;selectedCategoryId=null;categoryId=null;idCategory;successMessage="";isModalOpen=!1;excelFile;isCreateModalOpen=!1;isEditModalOpen=!1;fileSelected=!1;ngOnInit(){let t=this.route.snapshot.paramMap.get("categoryId");if(this.categoryId=t?Number(t):null,this.categoryId&&!isNaN(this.categoryId))this.idCategory=this.categoryId;else{console.warn("No se recibi\xF3 un ID de categor\xEDa v\xE1lido."),alert("Error: No se recibi\xF3 un ID de categor\xEDa v\xE1lido.");return}this.loadCollaboratorsByCategory()}loadCollaboratorsByCategory(){if(this.categoryId===null||this.categoryId===void 0){console.warn("categoryId es nulo o indefinido. No se puede proceder con la carga de colaboradores.");return}this.collaboratorService.getCollaboratorsByCategory(this.categoryId).subscribe(t=>{this.filteredCollaborators=Array.isArray(t.collaborators)?t.collaborators:[],this.filteredCollaborators.forEach((e,r)=>{})},t=>{console.error(`Error al cargar colaboradores para la categor\xEDa ${this.categoryId}:`,t)})}loadCategoriesAndCollaborators(){if(this.groupCategoryId==null){console.warn("groupCategoryId es nulo o indefinido. No se puede proceder con la carga de colaboradores.");return}this.collaboratorService.getAllCollaboratorCategories().subscribe(t=>{let r=(t.groupCategories||[]).filter(a=>a.id_group_category===this.groupCategoryId).map(a=>a.CollaboratorCategories).flat();if(this.categories=r,this.filteredCollaborators=[],r.length===0){console.warn("No hay categor\xEDas relevantes disponibles.");return}let o=r.length;r.forEach(a=>{this.collaboratorService.getCollaboratorsByCategory(a.id_category).subscribe(C=>{let oe=C.collaborators||[];this.filteredCollaborators.push(...oe),o--},C=>{console.error(`Error al cargar colaboradores para la categor\xEDa ${a.id_category}:`,C),o--})})},t=>{console.error("Error al cargar categor\xEDas de colaboradores:",t)})}triggerFileInput(){this.fileInput.nativeElement.click()}onCategorySelected(t){this.selectedCategoryId=t}navigateToImages(t){if(t==null){console.error("categoryId es nulo o indefinido. Navegaci\xF3n abortada.");return}this.router.navigate(["collaborator/image",t])}onFileSelected(t){let e=t.target.files[0];e&&(this.selectedImageFile=e)}onSubmitCollaboratorForm(){if(!this.selectedCollaborator.first_name||!this.selectedCollaborator.last_name||!this.selectedCollaborator.role||!this.selectedCollaborator.email||!this.selectedCollaborator.id_category){console.error("Error: Todos los campos son requeridos.");return}this.selectedCollaborator.id?this.updateCollaborator():this.createCollaborator()}openCreateCollaboratorModal(){this.selectedCollaborator={first_name:"",last_name:"",email:"",role:"",id_category:this.categoryId,is_active:!0},this.isCreateModalOpen=!0,this.isEditModalOpen=!1}openEditCollaboratorModal(t){if(!t.id_collaborator){console.error("Error: El colaborador seleccionado no tiene un ID v\xE1lido al abrir el modal:",t);return}this.selectedCollaborator=U(R({},t),{id:t.id_collaborator}),this.isEditModalOpen=!0}closeCreateModal(){this.isCreateModalOpen=!1,this.clearForm()}closeEditModal(){this.isEditModalOpen=!1,this.clearForm()}imagePreview=null;onImageSelected(t){let e=t.target;e.files&&e.files.length>0?(this.selectedImageFile=e.files[0],console.log("Imagen seleccionada:",this.selectedImageFile)):console.warn("No se seleccion\xF3 ninguna imagen.")}updateCollaborator(){if(!this.selectedCollaborator.first_name||!this.selectedCollaborator.last_name||!this.selectedCollaborator.role||!this.selectedCollaborator.email){console.error("Error: Todos los campos son requeridos, excepto la imagen al editar.");return}this.selectedCollaborator.id_category||(this.selectedCollaborator.id_category=this.categoryId);let t={first_name:this.selectedCollaborator.first_name,last_name:this.selectedCollaborator.last_name,email:this.selectedCollaborator.email,role:this.selectedCollaborator.role,id_category:this.selectedCollaborator.id_category,is_active:this.selectedCollaborator.is_active};this.collaboratorService.updateCollaborator(this.selectedCollaborator.id,t).subscribe(e=>{this.selectedImageFile?this.collaboratorService.updateCollaboratorImage(this.selectedCollaborator.id,this.selectedCollaborator.id_category,this.selectedImageFile).subscribe(r=>{this.successMessage="Colaborador actualizado exitosamente con nueva imagen",this.loadCategoriesAndCollaborators(),this.closeEditModal(),setTimeout(()=>{this.successMessage="",window.location.reload()},3e3)},r=>{console.error("Error al actualizar la imagen del colaborador:",r),alert("Hubo un problema al actualizar la imagen. El colaborador fue actualizado, pero la imagen no."),window.location.reload()}):(this.successMessage="Colaborador actualizado exitosamente",this.loadCategoriesAndCollaborators(),this.closeEditModal(),setTimeout(()=>{this.successMessage="",window.location.reload()},3e3))},e=>{console.error("Error al actualizar el colaborador:",e),alert("Error al actualizar el colaborador. Por favor, int\xE9ntalo de nuevo.")})}createCollaborator(){if(!this.selectedCollaborator.first_name||!this.selectedCollaborator.last_name||!this.selectedCollaborator.role||!this.selectedCollaborator.emailName||!this.selectedCollaborator.emailDomain){console.error("Error: Todos los campos son requeridos para crear un nuevo colaborador.");return}this.selectedCollaborator.email=`${this.selectedCollaborator.emailName}@${this.selectedCollaborator.emailDomain}`,this.selectedCollaborator.id_category=this.categoryId,this.collaboratorService.createCollaborator(this.selectedCollaborator,this.selectedImageFile||null).subscribe(t=>{this.loadCategoriesAndCollaborators(),this.successMessage="Colaborador agregado exitosamente",this.clearForm(),this.closeCreateModal(),setTimeout(()=>{this.successMessage="",window.location.reload()},3e3)},t=>{console.error("Error al crear el colaborador:",t)})}getCollaboratorImageUrl(t){return!t||!t.image_path?"":`https://totemvespucio.cl/assets/colaboradores/${t.image_path}`}onExcelFileSelected(t){let e=t.target;e.files&&e.files.length>0&&(this.fileSelected=!0)}uploadCollaboratorsByCategory(){if(!this.excelFile){alert("Por favor selecciona un archivo antes de subir.");return}if(!this.fileSelected){alert("Por favor selecciona un archivo antes de subir.");return}if(this.idCategory!==void 0&&this.idCategory!==null)this.collaboratorService.uploadCollaboratorsByCategory(this.idCategory,this.excelFile).subscribe({next:()=>{alert("Archivo subido exitosamente.")},error:t=>{console.error("Error al subir el archivo:",t),alert("Hubo un error al subir el archivo. Revisa la consola para m\xE1s detalles.")}});else{console.error("ID de categor\xEDa no definido."),alert("Error: El ID de la categor\xEDa no est\xE1 definido.");return}}downloadCollaboratorsByCategory(){if(this.idCategory===void 0||this.idCategory===null||isNaN(this.idCategory)){console.error("ID de categor\xEDa no definido o inv\xE1lido para la descarga."),alert("Error: No se ha definido un ID de categor\xEDa v\xE1lido para la descarga.");return}window.confirm("\xBFEst\xE1s seguro de que deseas descargar el listado de colaboradores?")&&this.collaboratorService.downloadCollaboratorsByCategory(this.idCategory).subscribe({next:e=>{let r=window.URL.createObjectURL(e),o=document.createElement("a");o.href=r,o.download=`Colaboradores_Categoria_${this.idCategory}.xlsx`,document.body.appendChild(o),o.click(),document.body.removeChild(o)},error:e=>{console.error("Error al descargar el archivo:",e),alert("Hubo un error al descargar el archivo. Por favor, revisa la consola para m\xE1s detalles.")}})}clearForm(){this.selectedCollaborator={first_name:"",last_name:"",email:"",role:"",id_category:this.categoryId,is_active:!0}}deleteCollaborator(t,e){if(window.confirm("\xBFEst\xE1s seguro de que deseas eliminar este colaborador?")){if(t==null||e==null){console.error("collaboratorId o idCategory es undefined",t,e);return}this.collaboratorService.deleteCollaborator(t,e).subscribe({next:()=>{this.loadCollaboratorsByCategory()},error:o=>{console.error("Error eliminando colaborador",o)}})}}toggleCollaboratorStatus(t,e){if(t==null||e==null){console.error("collaboratorId o idCategory es undefined:",t,e);return}this.collaboratorService.toggleCollaboratorStatus(t,e).subscribe(r=>{this.loadCollaboratorsByCategory()},r=>{console.error("Error al cambiar el estado del colaborador:",r)})}editCollaborator(t){this.selectedCollaborator=R({},t),this.selectedCollaborator.id_category=this.categoryId,this.isModalOpen=!0}cancelEdit(){this.selectedCollaborator={first_name:"",last_name:"",email:"",role:"",imagepath:"",is_active:!1}}goBack(){this.location.back()}static \u0275fac=function(e){return new(e||l)(w(S),w(K),w(Y),w(J),w(Q))};static \u0275cmp=T({type:l,selectors:[["app-collaborator-index"]],viewQuery:function(e,r){if(e&1&&W(et,5),e&2){let o;j(o=H())&&(r.fileInput=o.first)}},standalone:!0,features:[V],decls:24,vars:5,consts:[["fileInput",""],[1,"title"],[1,"left-button",3,"click"],[1,"custom-line"],[1,"btn-prn-con"],[4,"ngIf"],[1,"btn-prn",3,"click"],["type","file","id","uploadFile","accept",".xlsx, .xls",1,"selecc",2,"display","none",3,"change"],["class","btn-prn",3,"click",4,"ngIf"],["type","button",1,"btn-prn",3,"click"],["id","createCollaboratorModal","class","modal collaborator-modal",4,"ngIf"],["id","editCollaboratorModal","class","modal edit-collaborator-modal",4,"ngIf"],[1,"container"],["class","card",4,"ngFor","ngForOf"],["id","createCollaboratorModal",1,"modal","collaborator-modal"],[1,"modal-content"],[1,"modal-header"],["type","button",1,"close",3,"click"],[1,"modal-body"],[3,"ngSubmit"],[1,"form-group"],["for","first_name"],["type","text","id","first_name","name","first_name","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","last_name"],["type","text","id","last_name","name","last_name","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","email"],["type","email","id","email","name","email","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","role"],["type","text","id","role","name","role","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","image"],["type","file","id","image","accept","image/*",1,"form-control",3,"change"],[1,"modal-footer"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-secondary",3,"click"],["id","editCollaboratorModal",1,"modal","edit-collaborator-modal"],[1,"edit-form-row"],[1,"edit-form-group"],["for","edit_first_name"],["type","text","id","edit_first_name","name","first_name","required","",1,"edit-form-control",3,"ngModelChange","ngModel"],["for","edit_last_name"],["type","text","id","edit_last_name","name","last_name","required","",1,"edit-form-control",3,"ngModelChange","ngModel"],["for","edit_email"],["type","email","id","edit_email","name","email","required","",1,"edit-form-control",3,"ngModelChange","ngModel"],["for","edit_role"],["type","text","id","edit_role","name","role","required","",1,"edit-form-control",3,"ngModelChange","ngModel"],["for","edit_image"],["type","file","id","edit_image","accept","image/*",1,"edit-form-control",3,"change"],["class","edit-image-preview",4,"ngIf"],[1,"edit-image-preview"],["alt","Vista previa de la imagen",3,"src"],[1,"card"],[1,"col-info"],["class","profile","alt","Imagen-del-colaborador",3,"src",4,"ngIf"],[1,"inputed"],[1,"lowercase-text"],[1,"btn-col"],[3,"click"],["alt","Imagen-del-colaborador",1,"profile",3,"src"]],template:function(e,r){if(e&1){let o=h();i(0,"div",1)(1,"h1"),c(2,"Colaboradores"),n()(),i(3,"button",2),m("click",function(){return g(o),p(r.goBack())}),c(4,"\u21A9 Volver"),n(),E(5,"hr",3),i(6,"div",4),_(7,tt,3,0,"div",5),i(8,"button",6),m("click",function(){return g(o),p(r.triggerFileInput())}),c(9," Subir Archivo \u2B06\uFE0F "),n(),i(10,"input",7,0),m("change",function(C){return g(o),p(r.onExcelFileSelected(C))}),n(),_(12,ot,2,0,"button",8),i(13,"button",6),m("click",function(){return g(o),p(r.downloadCollaboratorsByCategory())}),c(14," Descargar Archivo Excel \u2B07\uFE0F "),n(),i(15,"button",9),m("click",function(){return g(o),p(r.openCreateCollaboratorModal())}),c(16," Agregar Nuevo Colaborador "),i(17,"span"),c(18,"\u2795"),n()()(),_(19,rt,34,4,"div",10)(20,it,37,5,"div",11),E(21,"hr",3),i(22,"div",12),_(23,lt,25,6,"div",13),n()}e&2&&(d(7),u("ngIf",r.categoryId!=null),d(5),u("ngIf",r.fileSelected),d(7),u("ngIf",r.isCreateModalOpen),d(),u("ngIf",r.isEditModalOpen),d(3),u("ngForOf",r.filteredCollaborators))},dependencies:[A,be,X,Z,_e,he,ee,Ce,k,O,P],styles:['@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Light.ttf) format("truetype");font-weight:300;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-LightItalic.ttf) format("truetype");font-weight:300;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Black.ttf) format("truetype");font-weight:900;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BlackItalic.ttf) format("truetype");font-weight:900;font-style:italic}*[_ngcontent-%COMP%]{font-family:Merriweather}.title[_ngcontent-%COMP%]{background-color:#fff;border-radius:15px;border-style:solid!important;border-width:2px!important;border-radius:5px!important;border-color:#fbb414;margin-bottom:1rem}.modal[_ngcontent-%COMP%]{display:block;position:fixed;z-index:1000;left:50%;top:50%;transform:translate(-50%,-50%);background-color:#fff;box-shadow:0 4px 8px #0003;padding:20px;border-radius:5px}.modal-content[_ngcontent-%COMP%]{padding:10px}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:10px}.close[_ngcontent-%COMP%]{background:none;border:none;font-size:20px;cursor:pointer}.container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;justify-content:flex-start}.card[_ngcontent-%COMP%]{background-color:#fff;border-style:solid;border-width:2px;border-color:#fbb414;width:250px;border-radius:10px;margin-bottom:1rem;box-shadow:0 4px 8px #0000001a;padding:15px;box-sizing:border-box;display:flex;flex-wrap:wrap;flex-direction:row;font-size:small;margin-right:25px;margin-left:10px;margin-top:20px}.btn-prn[_ngcontent-%COMP%]{width:240px;font-size:small;border-radius:5px;margin:10px 48px 20px 10px}.btn-prn-con[_ngcontent-%COMP%]{box-sizing:border-box;display:flex;flex-wrap:wrap;flex-direction:row;font-size:small}.lowercase-text[_ngcontent-%COMP%]{text-transform:lowercase}.custom-line[_ngcontent-%COMP%]{border-radius:10px;border-top:10px solid;border-color:#fbb414;margin:20px 0;width:100%}.btn-col[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:.5rem;margin-top:2px!important;margin-bottom:0%!important}.col-info[_ngcontent-%COMP%]{margin-left:0!important;font-size:small;margin-bottom:5px!important;line-height:1;align-content:left;width:auto}button[_ngcontent-%COMP%]{width:auto;padding:5px 10px;border-radius:5px;font-size:small;display:flex;align-items:center;justify-content:center;border-color:#fbb414!important;margin-bottom:5px!important}button[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 12px #0003}.selecc[_ngcontent-%COMP%]{margin:5px!important;background-color:#fff;border-radius:5px;border-color:#fbb414}.profile[_ngcontent-%COMP%]{width:150px!important;border-radius:8px;margin-bottom:10px;border:none;margin-left:30px;margin-top:5px!important}.form-control[_ngcontent-%COMP%]{margin-right:1rem!important}.collaborator-modal[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .collaborator-modal[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%], .collaborator-modal[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .collaborator-modal[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{margin-right:1rem;width:calc(100% - 1rem);box-sizing:border-box}.collaborator-modal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:15px}.modal-content[_ngcontent-%COMP%]{border:2px solid #fbb414}.collaborator-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:20px;justify-content:flex-start;padding:20px;width:100%;box-sizing:border-box;border-radius:10px;border-style:solid!important;border-width:2px;border-color:#fbb414}.edit-form-row[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem}.edit-form-group[_ngcontent-%COMP%]{flex:1}.edit-form-control[_ngcontent-%COMP%]{width:350px;padding:8px;font-size:14px;border:1px solid #ccc;border-radius:5px}.edit-image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:150px;border:1px solid #ccc;border-radius:5px;margin-top:1rem}']})};function st(l,t){if(l&1){let e=h();i(0,"div",10)(1,"div",11)(2,"div",12)(3,"h2"),c(4,"Subir Im\xE1genes"),n(),i(5,"button",13),m("click",function(){g(e);let o=s();return p(o.isUploadModalOpen=!1)}),c(6,"\u2716"),n()(),i(7,"div",14)(8,"input",15),m("change",function(o){g(e);let a=s();return p(a.onFileSelected(o))}),n(),i(9,"button",16),m("click",function(){g(e);let o=s();return p(o.uploadImages())}),c(10," Subir Im\xE1genes "),n()()()()}if(l&2){let e=s();d(9),u("disabled",e.selectedImages.length===0)}}function ct(l,t){if(l&1&&E(0,"img",19),l&2){let e=s().$implicit,r=s();u("src",r.getFullImagePath(e.image_path),D)}}function dt(l,t){if(l&1){let e=h();i(0,"div",17),m("click",function(){let o=g(e).$implicit,a=s();return p(a.selectCollaborator(o))}),_(1,ct,1,1,"img",18),i(2,"p")(3,"strong"),c(4,"Nombre:"),n(),c(5),n()()}if(l&2){let e=t.$implicit,r=s();se("selected",(r.selectedCollaborator==null?null:r.selectedCollaborator.id_collaborator)===e.id_collaborator),d(),u("ngIf",e.image_path),d(4),q(" ",e.first_name," ",e.last_name," ")}}function gt(l,t){if(l&1){let e=h();i(0,"button",1),m("click",function(){g(e);let o=s().$implicit,a=s();return p(a.addAssignment(a.selectedCollaborator.id_collaborator,o.id_image))}),c(1),n()}if(l&2){let e=s(2);d(),M(" Asignar a ",e.selectedCollaborator.first_name," ")}}function pt(l,t){if(l&1&&(i(0,"div",20),E(1,"img",21),i(2,"p"),c(3),n(),_(4,gt,2,1,"button",22),n()),l&2){let e=t.$implicit,r=s();d(),ge("alt",e.original_name),u("src",r.getFullImagePath(e.unique_name),D),d(2),I(e.original_name),d(),u("ngIf",r.selectedCollaborator)}}var B=class l{constructor(t,e,r,o){this.collaboratorService=t;this.location=e;this.route=r;this.changeDetector=o}imageBasePath="https://totemvespucio.cl/assets/colaboradores/";filteredCollaborators=[];unassignedImages=[];selectedCollaborator=null;selectedImages=[];categoryId=null;loading=!1;isUploadModalOpen=!1;formData=new FormData;assignments;ngOnInit(){let t=this.route.snapshot.paramMap.get("categoryId");this.categoryId=t?Number(t):null,this.categoryId&&!isNaN(this.categoryId)?(this.loadCollaboratorsByCategory(),this.loadUnassignedImages()):(console.warn("No se recibi\xF3 un ID de categor\xEDa v\xE1lido."),alert("Error: No se recibi\xF3 un ID de categor\xEDa v\xE1lido."))}loadCollaboratorsByCategory(){if(this.categoryId==null){console.warn("categoryId es nulo o indefinido. No se puede proceder con la carga de colaboradores.");return}this.collaboratorService.getAllCollaborators().subscribe(t=>{t&&t.collaborators&&Array.isArray(t.collaborators)?(this.filteredCollaborators=t.collaborators.filter(e=>Number(e.id_collaborator_category)===this.categoryId),this.filteredCollaborators.length===0&&console.warn(`No se encontraron colaboradores para la categor\xEDa con ID ${this.categoryId}`)):console.warn("La respuesta no contiene un array v\xE1lido de colaboradores.")},t=>{console.error(`Error al cargar colaboradores para la categor\xEDa ${this.categoryId}:`,t)})}loadUnassignedImages(){this.collaboratorService.getUnassignedCollaboratorImages().subscribe(t=>{this.unassignedImages=t.images||[]},t=>{console.error("Error al cargar las im\xE1genes sin asignar:",t)})}openUploadModal(){this.isUploadModalOpen=!0}closeUploadModal(){this.isUploadModalOpen=!1,this.selectedImages=[]}selectCollaborator(t){this.selectedCollaborator=t}getFullImagePath(t){if(!t)return console.warn("Nombre de imagen no proporcionado, mostrando imagen por defecto."),"https://totemvespucio.cl/assets/colaboradores/placeholder.png";let e=`${this.imageBasePath}${t}`;return console.log("URL completa para la imagen:",e),e}onFileSelected(t){t.target.files&&t.target.files.length>0&&(this.selectedImages=Array.from(t.target.files),console.log("Archivos seleccionados:",this.selectedImages))}uploadImages(){if(this.selectedImages.length===0){alert("Por favor selecciona al menos un archivo para subir.");return}this.loading=!0,this.collaboratorService.uploadMultipleImages(this.selectedImages).subscribe(t=>{console.log("Respuesta del servidor al subir las im\xE1genes:",t),t.success?(alert("Im\xE1genes subidas exitosamente."),this.selectedImages=[],this.loadUnassignedImages()):alert("Ocurri\xF3 un problema al subir las im\xE1genes. Verifica la respuesta del servidor.")},t=>{console.error("Error al subir las im\xE1genes:",t),alert("Hubo un error al subir las im\xE1genes. Por favor intenta de nuevo.")},()=>{this.loading=!1})}assignImages(){if(this.assignments.length===0){alert("Por favor selecciona al menos una asignaci\xF3n.");return}this.collaboratorService.assignImagesToCollaborators(this.assignments).subscribe({next:t=>{t.success?(alert("Im\xE1genes asignadas exitosamente."),this.assignments=[],this.loadUnassignedImages(),window.location.reload()):alert("Ocurri\xF3 un problema al asignar las im\xE1genes.")},error:t=>{console.error("Error al asignar im\xE1genes:",t),alert("Error al asignar im\xE1genes. Por favor intenta de nuevo.")}})}addAssignment(t,e){let r=parseInt(t,10),o=parseInt(e,10);if(isNaN(r)||isNaN(o)){console.error("Error: Los valores proporcionados no son n\xFAmeros v\xE1lidos.");return}let a={id_collaborator:r,id_image:o};this.collaboratorService.assignImagesToCollaborators([a]).subscribe({next:C=>{C.success?(alert("Imagen asignada exitosamente."),window.location.reload()):alert("Ocurri\xF3 un problema al asignar la imagen.")},error:C=>{console.error("Error al asignar la imagen:",C),alert("Error al asignar la imagen. Por favor intenta de nuevo.")}})}deleteAllUnassignedImages(){if(confirm("\xBFEst\xE1s seguro de que deseas eliminar todas las im\xE1genes sin asignar? Esta acci\xF3n no se puede deshacer.")){if(this.unassignedImages.length===0){alert("No hay im\xE1genes sin asignar para eliminar.");return}let t=[...this.unassignedImages],e=!1;t.forEach((r,o)=>{this.collaboratorService.deleteAllUnassignedImages(r.id_image).subscribe({next:a=>{console.log(`Imagen con ID ${r.id_image} eliminada exitosamente.`),this.unassignedImages=this.unassignedImages.filter(C=>C.id_image!==r.id_image)},error:a=>{console.error(`Error al eliminar la imagen con ID ${r.id_image}:`,a),e=!0},complete:()=>{o===t.length-1&&(e?alert("Ocurrieron errores al intentar eliminar algunas im\xE1genes. Revisa la consola para m\xE1s detalles."):(alert("Todas las im\xE1genes sin asignar han sido eliminadas exitosamente."),this.loadUnassignedImages()))}})})}}goBack(){this.location.back()}static \u0275fac=function(e){return new(e||l)(w(S),w(Y),w(J),w(Q))};static \u0275cmp=T({type:l,selectors:[["app-collaborator-image"]],standalone:!0,features:[V],decls:15,vars:3,consts:[[1,"left-button",3,"click"],[3,"click"],["class","modal",4,"ngIf"],[1,"container-main"],[1,"left-column"],[1,"subtitle"],[1,"column-content"],["class","col-info card",3,"selected","click",4,"ngFor","ngForOf"],[1,"right-column"],["class","image-card",4,"ngFor","ngForOf"],[1,"modal"],[1,"modal-content"],[1,"modal-header"],[1,"close",3,"click"],[1,"modal-body"],["type","file","multiple","",3,"change"],[3,"click","disabled"],[1,"col-info","card",3,"click"],["class","profile","alt","Imagen del colaborador",3,"src",4,"ngIf"],["alt","Imagen del colaborador",1,"profile",3,"src"],[1,"image-card"],[1,"foto-perfil",3,"src","alt"],[3,"click",4,"ngIf"]],template:function(e,r){e&1&&(i(0,"button",0),m("click",function(){return r.goBack()}),c(1,"\u21A9 Volver"),n(),i(2,"button",1),m("click",function(){return r.openUploadModal()}),c(3,"\u{1F4E4} Subir Im\xE1genes"),n(),_(4,st,11,1,"div",2),i(5,"div",3)(6,"div",4)(7,"h3",5),c(8,"Colaboradores"),n(),i(9,"div",6),_(10,dt,6,5,"div",7),n()(),i(11,"div",8)(12,"h3",5),c(13,"Im\xE1genes Sin Asignar"),n(),_(14,pt,5,4,"div",9),n()()),e&2&&(d(4),u("ngIf",r.isUploadModalOpen),d(6),u("ngForOf",r.filteredCollaborators),d(4),u("ngForOf",r.unassignedImages))},dependencies:[k,O,P],styles:['@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Light.ttf) format("truetype");font-weight:300;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-LightItalic.ttf) format("truetype");font-weight:300;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Black.ttf) format("truetype");font-weight:900;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BlackItalic.ttf) format("truetype");font-weight:900;font-style:italic}*[_ngcontent-%COMP%]{font-family:Merriweather,sans-serif}.container-main[_ngcontent-%COMP%]{display:flex;width:100%;padding:20px;gap:20px;box-sizing:border-box}.left-column[_ngcontent-%COMP%], .right-column[_ngcontent-%COMP%]{flex:1;padding:20px;border:1px solid #fbb414;border-radius:10px;background-color:#fff;box-sizing:border-box;overflow-y:auto;display:flex;flex-direction:column;gap:1rem}.subtitle[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin-bottom:1rem;text-align:center}.column-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:1rem}.card[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #fbb414;border-radius:10px;padding:10px;text-align:center;box-shadow:0 4px 8px #0000001a;cursor:pointer;height:250px}.card.selected[_ngcontent-%COMP%]{border-color:#fbb414;box-shadow:0 0 10px #ff7b00;background-color:#fbb414}.foto-perfil[_ngcontent-%COMP%]{width:120px;margin-bottom:10px;border-radius:5px;object-fit:cover}.profile[_ngcontent-%COMP%]{width:130px;height:auto;border-radius:50%}button[_ngcontent-%COMP%]{width:auto;padding:5px 10px;border-radius:5px;font-size:small;display:flex;align-items:center;justify-content:center;border-color:#fbb414!important;border-style:solid;margin-bottom:5px!important}button[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 12px #0003}.image-card[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #fbb414;border-radius:10px;text-align:center;box-shadow:0 4px 8px #0000001a;cursor:pointer;height:250px}.image-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;justify-content:flex-start}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:10px;width:400px;max-width:90%;box-shadow:0 5px 15px #0000004d;position:relative}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.modal-header[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{background:none;border:none;font-size:1.5rem;cursor:pointer}.modal-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:auto;padding:10px 20px;border-radius:5px;font-size:1rem;border:1px solid #fbb414;background-color:#fbb414;color:#fff;cursor:pointer}.modal-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#e6a409}.modal-body[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:block;margin-bottom:1rem}']})};var mt=[{path:"",component:G},{path:"index/:categoryId",component:F},{path:"image/:categoryId",component:B}],te=class l{static \u0275fac=function(e){return new(e||l)};static \u0275mod=L({type:l});static \u0275inj=z({imports:[N.forChild(mt),N]})};var Se=class l{static \u0275fac=function(e){return new(e||l)};static \u0275mod=L({type:l,bootstrap:[l]});static \u0275inj=z({providers:[S],imports:[k,A,te,G,F,B,N]})};export{Se as CollaboratorModule};
