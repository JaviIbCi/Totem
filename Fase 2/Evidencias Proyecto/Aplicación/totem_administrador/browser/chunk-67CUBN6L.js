import{a as $}from"./chunk-NRKFFC3A.js";import{b as G,d as Q,e as J,f as Z,g as K,h as X,p as Y,t as ee}from"./chunk-DQGBAIQE.js";import{a as k,c as W,k as H,m as T,n as V}from"./chunk-X2DCTIRQ.js";import{Ab as s,Bb as R,Cb as f,Eb as _,F as O,Fb as P,Gb as C,Ib as x,Ka as a,La as h,Mb as A,Nb as B,Pb as j,Y as N,Ya as d,Z as w,ab as c,ba as F,bb as z,ga as y,ha as M,hb as i,ib as n,ob as U,qb as m,rc as D,sc as b,tc as q,wc as g,zb as L}from"./chunk-INDI3DVQ.js";var u=class t{constructor(r,e){this.http=r;this.renewService=e}apiUrl=V.apiUrl;changePassword(r,e,o,p){let l=localStorage.getItem("accessToken"),oe=new k({Authorization:`Bearer ${l}`}),ne={user_id:r,oldPassword:e,newPassword:o,accountToken:p};return this.http.post(`${this.apiUrl}administrator/users/change-password`,ne,{headers:oe}).pipe(O(ie=>this.renewService.handleTokenError(ie,()=>this.changePassword(r,e,o,p))))}getMyPermissions(){let r=localStorage.getItem("accessToken"),e=new k({Authorization:`Bearer ${r}`});return this.http.get(`${this.apiUrl}administrator/users/my-permissions`,{headers:e}).pipe(O(o=>this.renewService.handleTokenError(o,()=>this.getMyPermissions())))}static \u0275fac=function(e){return new(e||t)(F(W),F($))};static \u0275prov=N({token:t,factory:t.\u0275fac,providedIn:"root"})};function le(t,r){if(t&1&&(i(0,"span"),s(1),n()),t&2){let e=m().$implicit;a(),f(" - FAQ: ",e.faq_category.faq_category_name,"")}}function ce(t,r){if(t&1&&(i(0,"span"),s(1),n()),t&2){let e=m().$implicit;a(),f(" - Colaborador: ",e.collaborator_category.collaborator_category_name,"")}}function me(t,r){if(t&1&&(i(0,"span"),s(1),n()),t&2){let e=m().$implicit;a(),f(" - Info: ",e.info.information_title,"")}}function pe(t,r){if(t&1&&(i(0,"li"),s(1),d(2,le,2,1,"span",6)(3,ce,2,1,"span",6)(4,me,2,1,"span",6),n()),t&2){let e=r.$implicit,o=m(3);z("background-color",o.getPermissionColor(e)),a(),f(" ",e.permission_name," "),a(),c("ngIf",e.faq_category),a(),c("ngIf",e.collaborator_category),a(),c("ngIf",e.info)}}function de(t,r){if(t&1&&(i(0,"div")(1,"h3"),s(2),A(3,"uppercase"),n(),i(4,"ul",4),d(5,pe,5,6,"li",5),n()()),t&2){let e=r.$implicit,o=m(2);a(2),R(B(3,2,e)),a(3),c("ngForOf",o.categorizedPermissions[e])}}function fe(t,r){if(t&1&&(i(0,"div"),d(1,de,6,4,"div",3),n()),t&2){let e=m();a(),c("ngForOf",e.modules)}}function ge(t,r){t&1&&(i(0,"p"),s(1,"No tienes permisos asignados actualmente."),n())}var S=class t{constructor(r){this.myUserService=r}userPermissions=[];categorizedPermissions={};modules=[];ngOnInit(){this.loadPermissions()}loadPermissions(){this.myUserService.getMyPermissions().subscribe(r=>{r&&r.permissions&&(this.userPermissions=r.permissions,this.categorizePermissions())})}categorizePermissions(){this.userPermissions&&this.userPermissions.length>0&&(this.userPermissions.forEach(r=>{let e=this.getSpanishModuleName(r.module)||"Otros";this.categorizedPermissions[e]||(this.categorizedPermissions[e]=[]),this.categorizedPermissions[e].push(r)}),this.modules=Object.keys(this.categorizedPermissions))}getPermissionColor(r){switch(r.module){case"global":return"gold";case"users":return"yellow";case"permissions":return"red";case"news":return"blue";case"maps":return"orange";case"faqs":return"grey";case"stats":return"beige";case"collaborators":return"pink";case"information":return"green";default:return"lightgrey"}}getSpanishModuleName(r){switch(r){case"global":return"Global";case"users":return"Usuarios";case"permissions":return"Permisos";case"news":return"Noticias";case"maps":return"Mapas";case"faqs":return"FAQs";case"stats":return"Estad\xEDsticas";case"collaborators":return"Colaboradores";case"information":return"Informaci\xF3n";default:return"Otros"}}static \u0275fac=function(e){return new(e||t)(h(u))};static \u0275cmp=y({type:t,selectors:[["app-my-profile"]],standalone:!0,features:[x],decls:6,vars:2,consts:[["noPermissions",""],[1,"profile-container"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[1,"permissions-list"],[3,"background-color",4,"ngFor","ngForOf"],[4,"ngIf"]],template:function(e,o){if(e&1&&(i(0,"div",1)(1,"h2"),s(2,"Mis Permisos"),n(),d(3,fe,2,1,"div",2)(4,ge,2,0,"ng-template",null,0,j),n()),e&2){let p=L(5);a(3),c("ngIf",o.userPermissions.length>0)("ngIfElse",p)}},dependencies:[g,D,b,q],styles:['@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Light.ttf) format("truetype");font-weight:300;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-LightItalic.ttf) format("truetype");font-weight:300;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Black.ttf) format("truetype");font-weight:900;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BlackItalic.ttf) format("truetype");font-weight:900;font-style:italic}.profile-container[_ngcontent-%COMP%]{width:100%;max-width:800px;margin:0 auto;padding:20px;background-color:#fff;border-radius:10px;box-shadow:0 4px 10px #0000001a;box-sizing:border-box}h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:24px}.permissions-list[_ngcontent-%COMP%]{list-style:none;padding:0}.permissions-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:10px;margin-bottom:10px;border-radius:5px;color:#000;font-weight:700;font-size:16px;background-color:#d3d3d3}.permissions-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:nth-child(odd){background-color:#f1f1f1}.permissions-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}p[_ngcontent-%COMP%]{color:#999;font-size:16px}']})};function ue(t,r){if(t&1&&(i(0,"div",12),s(1),n()),t&2){let e=m();a(),f(" ",e.passwordError," ")}}function he(t,r){if(t&1&&(i(0,"div",13),s(1),n()),t&2){let e=m();a(),f(" ",e.successMessage," ")}}var I=class t{constructor(r,e){this.myUserService=r;this.router=e}currentPassword="";newPassword="";confirmPassword="";passwordError="";successMessage="";validatePassword(){let r=/[A-Z]/.test(this.newPassword),e=/[a-z]/.test(this.newPassword),o=/\d/.test(this.newPassword);return this.newPassword.length>=8?this.newPassword!==this.confirmPassword?(this.passwordError="Las contrase\xF1as no coinciden.",!1):!r||!e||!o?(this.passwordError="La contrase\xF1a debe incluir al menos una letra may\xFAscula, una min\xFAscula y un n\xFAmero.",!1):(this.passwordError="",!0):(this.passwordError="La contrase\xF1a debe tener al menos 8 caracteres.",!1)}changePassword(){if(!this.validatePassword())return;let r=this.getUserIdFromLocalStorage(),e=this.getAccountTokenFromLocalStorage();this.myUserService.changePassword(r,this.currentPassword,this.newPassword,e).subscribe(o=>{o.success?(this.successMessage="Contrase\xF1a cambiada correctamente. Cerrando sesi\xF3n...",setTimeout(()=>{this.clearSession(),this.router.navigate(["/login"])},3e3)):this.passwordError=o.message||"Ocurri\xF3 un error al cambiar la contrase\xF1a."},o=>{console.error("Error al cambiar la contrase\xF1a:",o),this.passwordError=o.message||"Ocurri\xF3 un error al cambiar la contrase\xF1a."})}getUserIdFromLocalStorage(){return JSON.parse(localStorage.getItem("userDetails")||"{}").id_user}getAccountTokenFromLocalStorage(){return localStorage.getItem("accountToken")||""}clearSession(){localStorage.removeItem("accessToken"),localStorage.removeItem("accountToken"),localStorage.removeItem("userDetails"),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("loginTime")}static \u0275fac=function(e){return new(e||t)(h(u),h(H))};static \u0275cmp=y({type:t,selectors:[["app-change-password"]],standalone:!0,features:[x],decls:29,vars:5,consts:[[1,"change-password-container"],[3,"ngSubmit"],["for","currentPassword"],["type","password","id","currentPassword","name","currentPassword","required","",3,"ngModelChange","ngModel"],["for","newPassword"],["type","password","id","newPassword","name","newPassword","required","",3,"ngModelChange","ngModel"],["for","confirmPassword"],["type","password","id","confirmPassword","name","confirmPassword","required","",3,"ngModelChange","ngModel"],["class","error-message",4,"ngIf"],[1,"password-guidelines"],["type","submit",1,"submit-button"],["class","success-message",4,"ngIf"],[1,"error-message"],[1,"success-message"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"h2"),s(2,"Cambiar Contrase\xF1a"),n(),i(3,"form",1),U("ngSubmit",function(){return o.changePassword()}),i(4,"label",2),s(5,"Contrase\xF1a Actual:"),n(),i(6,"input",3),C("ngModelChange",function(l){return P(o.currentPassword,l)||(o.currentPassword=l),l}),n(),i(7,"label",4),s(8,"Nueva Contrase\xF1a:"),n(),i(9,"input",5),C("ngModelChange",function(l){return P(o.newPassword,l)||(o.newPassword=l),l}),n(),i(10,"label",6),s(11,"Confirmar Nueva Contrase\xF1a:"),n(),i(12,"input",7),C("ngModelChange",function(l){return P(o.confirmPassword,l)||(o.confirmPassword=l),l}),n(),d(13,ue,2,1,"div",8),i(14,"div",9)(15,"small"),s(16,"Recomendaciones de seguridad:"),n(),i(17,"ul")(18,"li"),s(19,"Al menos 8 caracteres"),n(),i(20,"li"),s(21,"Al menos una letra may\xFAscula"),n(),i(22,"li"),s(23,"Al menos una letra min\xFAscula"),n(),i(24,"li"),s(25,"Al menos un n\xFAmero"),n()()(),i(26,"button",10),s(27,"Cambiar Contrase\xF1a"),n(),d(28,he,2,1,"div",11),n()()),e&2&&(a(6),_("ngModel",o.currentPassword),a(3),_("ngModel",o.newPassword),a(3),_("ngModel",o.confirmPassword),a(),c("ngIf",o.passwordError),a(15),c("ngIf",o.successMessage))},dependencies:[g,b,ee,X,G,Q,J,Y,K,Z],styles:['@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Light.ttf) format("truetype");font-weight:300;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-LightItalic.ttf) format("truetype");font-weight:300;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Black.ttf) format("truetype");font-weight:900;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BlackItalic.ttf) format("truetype");font-weight:900;font-style:italic}.change-password-container[_ngcontent-%COMP%]{width:100%;max-width:600px;margin:0 auto;padding:20px;background-color:#fff;border-radius:10px;box-shadow:0 4px 10px #0000001a}input[type=password][_ngcontent-%COMP%]{width:100%;max-width:100%;padding:10px;margin-bottom:15px;border-radius:5px;border:1px solid #ccc;box-sizing:border-box}h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:24px;text-align:center}label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:700}input[_ngcontent-%COMP%]{width:100%;padding:10px;margin-bottom:15px;border:1px solid #ccc;border-radius:5px}.error-message[_ngcontent-%COMP%]{color:red;font-size:14px;margin-bottom:15px}.password-guidelines[_ngcontent-%COMP%]{margin-bottom:15px}.password-guidelines[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:block;margin-bottom:5px}ul[_ngcontent-%COMP%]{list-style:none;padding-left:0}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:5px}.submit-button[_ngcontent-%COMP%]{width:100%;padding:10px;background-color:#007bff;color:#fff;border:none;border-radius:5px;cursor:pointer;font-size:16px}.submit-button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.success-message[_ngcontent-%COMP%]{margin-top:20px;color:green;font-size:14px;text-align:center}']})};var we=[{path:"my-profile",component:S},{path:"change-password",component:I}],E=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=M({type:t});static \u0275inj=w({imports:[T.forChild(we),T]})};var re=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=M({type:t});static \u0275inj=w({imports:[g,E]})};export{re as ProfileModule};
