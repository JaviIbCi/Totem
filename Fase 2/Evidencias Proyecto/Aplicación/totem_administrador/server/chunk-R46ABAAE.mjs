import './polyfills.server.mjs';
import{a as z}from"./chunk-MYRRTMDS.mjs";import{a as pe,b as ue,d as _e,e as ge,f as fe,g as be,h as he,m as xe,n as ve,o as Ce,p as Pe,t as H}from"./chunk-7Q4IHH5Z.mjs";import{a as j}from"./chunk-NEDADJCY.mjs";import{a as P,c as R,m as me,p as q,r as I}from"./chunk-ZW4IHJJG.mjs";import{$a as re,Ab as C,Ac as de,B as v,Bb as le,Cb as y,Db as M,Dc as U,Eb as w,Gb as $,Hb as S,Ia as l,Ib as ce,Ja as k,Jb as te,Kb as ne,Lb as ie,U as L,V,Wa as u,Z as O,_a as p,ca as F,da as N,fb as a,gb as s,hb as E,ib as oe,jb as se,kb as b,la as g,ma as f,mb as _,ob as m,rb as ae,xc as B,yb as c,yc as D,zb as x,zc as A}from"./chunk-EC3LRZMX.mjs";import{a as Z,b as ee}from"./chunk-5XUXGTUW.mjs";var W=class o{constructor(t,e){this.http=t;this.renewService=e}apiUrl=j.apiUrl;addUser(t){let e=localStorage.getItem("accessToken"),n=new P({Authorization:`Bearer ${e}`}),i={username:t};return this.http.post(`${this.apiUrl}administrator/users/add`,i,{headers:n}).pipe(v(r=>this.renewService.handleTokenError(r,()=>this.addUser(t))))}getAllUsers(){let t=localStorage.getItem("accessToken"),e=new P({Authorization:`Bearer ${t}`});return this.http.get(`${this.apiUrl}administrator/users/all`,{headers:e}).pipe(v(n=>this.renewService.handleTokenError(n,()=>this.getAllUsers())))}blockOrUnblockUser(t,e){let n=localStorage.getItem("accessToken"),i=new P({Authorization:`Bearer ${n}`}),r={user_id:t,is_blocked:e};return this.http.put(`${this.apiUrl}administrator/users/block-unblock`,r,{headers:i}).pipe(v(d=>this.renewService.handleTokenError(d,()=>this.blockOrUnblockUser(t,e))))}deleteUser(t){let e=localStorage.getItem("accessToken"),n=new P({Authorization:`Bearer ${e}`}),i={user_id:t};return this.http.delete(`${this.apiUrl}administrator/users/delete`,{headers:n,body:i}).pipe(v(r=>this.renewService.handleTokenError(r,()=>this.deleteUser(t))))}static \u0275fac=function(e){return new(e||o)(O(R),O(z))};static \u0275prov=L({token:o,factory:o.\u0275fac,providedIn:"root"})};var Ie=()=>[10],Te=o=>({blocked:o}),Le=()=>[11],Ve=()=>[17],Fe=()=>[12];function Ne(o,t){if(o&1){let e=b();a(0,"button",16),_("click",function(){g(e);let i=m();return f(i.openInviteModal())}),c(1,"Invitar Nuevo Usuario"),s()}}function $e(o,t){o&1&&(a(0,"div",34),c(1," Los nombres de usuario no coinciden. "),s())}function Be(o,t){o&1&&(a(0,"div",35),c(1,"Cargando..."),s())}function De(o,t){if(o&1){let e=b();a(0,"div",17)(1,"div",18)(2,"h3"),c(3,"Invitar a Nuevo Usuario"),s(),a(4,"form",19),_("ngSubmit",function(){g(e);let i=m();return f(i.inviteUser())}),a(5,"label",20),c(6,"Seleccionar Dominio"),s(),a(7,"select",21),w("ngModelChange",function(i){g(e);let r=m();return M(r.selectedDomain,i)||(r.selectedDomain=i),f(i)}),a(8,"option",22),c(9,"duoc.cl"),s(),a(10,"option",23),c(11,"duocuc.cl"),s(),a(12,"option",24),c(13,"profesor.duoc.cl"),s()(),a(14,"label",25),c(15,"Nombre de Usuario"),s(),a(16,"input",26),w("ngModelChange",function(i){g(e);let r=m();return M(r.username,i)||(r.username=i),f(i)}),s(),a(17,"label",27),c(18,"Confirmar Nombre de Usuario"),s(),a(19,"input",28),w("ngModelChange",function(i){g(e);let r=m();return M(r.confirmUsername,i)||(r.confirmUsername=i),f(i)}),s(),u(20,$e,2,0,"div",29)(21,Be,2,0,"div",30),a(22,"div",31)(23,"button",32),c(24," Enviar "),s(),a(25,"button",33),_("click",function(){g(e);let i=m();return f(i.closeInviteModal())}),c(26," Cancelar "),s()()()()()}if(o&2){let e=m();l(7),y("ngModel",e.selectedDomain),l(9),y("ngModel",e.username),l(3),y("ngModel",e.confirmUsername),l(),p("ngIf",e.username&&e.confirmUsername&&e.username!==e.confirmUsername),l(),p("ngIf",e.isLoading),l(2),p("disabled",e.username!==e.confirmUsername||e.isLoading),l(2),p("disabled",e.isLoading)}}function Ae(o,t){if(o&1&&(a(0,"option",36),c(1),s()),o&2){let e=t.$implicit;p("value",e.id_permission),l(),x(e.permission_name)}}function Re(o,t){if(o&1&&(a(0,"div"),c(1),s()),o&2){let e=t.$implicit,n=m(2);re("background-color",n.getPermissionColor(e)),l(),C(" ",e.permission_name," ")}}function qe(o,t){if(o&1){let e=b();a(0,"button",43),_("click",function(){g(e);let i=m().$implicit,r=m();return f(r.toggleBlockUser(i.id_user,i.is_blocked))}),c(1),s()}if(o&2){let e=m().$implicit;l(),C(" ",e.is_blocked?"Desbloquear":"Bloquear"," ")}}function je(o,t){if(o&1){let e=b();a(0,"button",44),_("click",function(){g(e);let i=m().$implicit,r=m();return f(r.editPermissions(i.id_user,i.username))}),c(1," Ver Permisos "),s()}}function ze(o,t){if(o&1){let e=b();a(0,"div",45)(1,"input",46),w("ngModelChange",function(i){g(e);let r=m().$implicit;return M(r.canDelete,i)||(r.canDelete=i),f(i)}),_("change",function(i){g(e);let r=m().$implicit,d=m();return f(d.toggleDelete(r,i))}),s(),a(2,"button",47),_("click",function(){g(e);let i=m().$implicit,r=m();return f(r.confirmDelete(i))}),E(3,"i",48),s()()}if(o&2){let e=m().$implicit,n=m();l(),y("ngModel",e.canDelete),p("disabled",e.id_user===n.currentUserId||e.id_user===1),l(),p("disabled",!e.canDelete||e.id_user===n.currentUserId||e.id_user===1)}}function He(o,t){if(o&1&&(a(0,"tr",37)(1,"td"),c(2),s(),a(3,"td"),c(4),s(),a(5,"td"),c(6),s(),a(7,"td")(8,"div",38),u(9,Re,2,3,"div",39),s()(),a(10,"td"),u(11,qe,2,1,"button",40)(12,je,2,0,"button",41),s(),a(13,"td"),u(14,ze,4,3,"div",42),s()()),o&2){let e=t.$implicit,n=m();p("ngClass",ce(8,Te,e.is_blocked)),l(2),x(e.id_user),l(2),x(e.username),l(2),x(e.is_blocked?"Bloqueado":"Activo"),l(3),p("ngForOf",e.permissions),l(2),p("ngIf",n.hasPermission(S(10,Le))&&e.id_user!==n.currentUserId&&e.id_user!==1),l(),p("ngIf",n.hasPermission(S(11,Ve))&&e.id_user!==n.currentUserId&&e.id_user!==1),l(2),p("ngIf",n.hasPermission(S(12,Fe)))}}var Q=class o{constructor(t,e){this.userService=t;this.router=e}users=[];filteredUsers=[];allPermissions=[];currentUserId=0;currentUserPermissions=[];searchQuery="";filterStatus="";filterPermission="";ngOnInit(){this.loadCurrentUserPermissions(),this.hasPermission([1,2,13])?this.loadUsers():console.error("No tienes los permisos necesarios para acceder a esta p\xE1gina")}loadCurrentUserPermissions(){let t=localStorage.getItem("userDetails");if(t){let e=JSON.parse(t);this.currentUserId=e.id_user,this.currentUserPermissions=e.permissionsDetails}}loadUsers(){this.userService.getAllUsers().subscribe(t=>{this.users=t.users.map(e=>{let n=e.permissions.map(r=>{let d=r.permission_name;return r.level==="categorical"&&(r.faq_category?d+=`: ${r.faq_category.faq_category_name}`:r.collaborator_category?d+=`: ${r.collaborator_category.collaborator_category_name}`:r.info&&(d+=`: ${r.info.information_title}`)),ee(Z({},r),{permission_name:d})}),i=this.groupPermissionsByModule(n);return ee(Z({},e),{permissions:n,canDelete:!1,groupedPermissions:i})}),this.filteredUsers=[...this.users],this.extractPermissions()},t=>{console.error("Error al obtener los usuarios:",t)})}groupPermissionsByModule(t){return t.reduce((e,n)=>(e[n.module]||(e[n.module]=[]),e[n.module].push(n),e),{})}applyFilters(){this.filteredUsers=this.users.filter(t=>{let e=t.username.toLowerCase().includes(this.searchQuery.toLowerCase()),n=this.filterStatus===""||this.filterStatus==="blocked"&&t.is_blocked||this.filterStatus==="active"&&!t.is_blocked,i=this.filterPermission===""||t.permissions.some(r=>r.id_permission===parseInt(this.filterPermission,10));return e&&n&&i})}extractPermissions(){let t=new Map;this.users.forEach(e=>{e.permissions.forEach(n=>{t.has(n.id_permission)||t.set(n.id_permission,n)})}),this.allPermissions=Array.from(t.values())}hasPermission(t){return this.currentUserPermissions.some(e=>t.includes(e.id_permission))||this.currentUserPermissions.some(e=>[1,3].includes(e.id_permission))}toggleBlockUser(t,e){if(!this.hasPermission([11])){console.error("No tienes permiso para bloquear/desbloquear usuarios");return}if(t===this.currentUserId){console.error("No puedes bloquearte a ti mismo");return}this.userService.blockOrUnblockUser(t,!e).subscribe(()=>{this.loadUsers()},n=>{console.error("Error al bloquear/desbloquear el usuario:",n)})}confirmDelete(t){if(!this.hasPermission([12])){console.error("No tienes permiso para eliminar usuarios");return}if(t.id_user===this.currentUserId){console.error("No puedes eliminarte a ti mismo");return}confirm(`\xBFEst\xE1s seguro de que quieres eliminar al usuario: ${t.username}?`)&&this.deleteUser(t.id_user)}toggleDelete(t,e){let n=e.target;t.canDelete=n.checked}deleteUser(t){this.userService.deleteUser(t).subscribe(()=>{this.loadUsers()},e=>{console.error("Error al eliminar el usuario:",e)})}editPermissions(t,e){if(!this.hasPermission([17])){console.error("No tienes permiso para editar permisos");return}this.router.navigate(["/users/permission",t],{queryParams:{username:e}})}getPermissionColor(t){switch(t.module){case"global":return"gold";case"users":return"yellow";case"permissions":return"red";case"news":return"blue";case"maps":return"orange";case"faqs":return"grey";case"stats":return"beige";case"collaborators":return"pink";case"information":return"green";default:return"lightgrey"}}username="";confirmUsername="";selectedDomain="duoc.cl";showInviteModal=!1;isLoading=!1;openInviteModal(){this.showInviteModal=!0}closeInviteModal(){this.showInviteModal=!1,this.username="",this.confirmUsername=""}hasPermissionToInvite(){return this.hasPermission([10])}inviteUser(){let t=`${this.username}@${this.selectedDomain}`;this.username===this.confirmUsername&&(this.isLoading=!0,this.userService.addUser(t).subscribe(()=>{alert("Invitaci\xF3n enviada correctamente"),this.isLoading=!1,this.closeInviteModal(),this.reloadPage()},e=>{this.isLoading=!1,e.message==="El nombre de usuario ya existe. Por favor, elige otro nombre de usuario."?alert("El nombre de usuario ya existe. Por favor, elige otro nombre de usuario."):alert("Hubo un error al invitar al usuario.")}))}reloadPage(){window.location.reload()}static \u0275fac=function(e){return new(e||o)(k(W),k(q))};static \u0275cmp=F({type:o,selectors:[["app-users-list"]],standalone:!0,features:[$],decls:36,vars:8,consts:[[1,"users-list-container"],[1,"tittle"],["class","invite-btn",3,"click",4,"ngIf"],["class","modal-backdrop",4,"ngIf"],[1,"filter-container"],["type","text","placeholder","Buscar por nombre de usuario",1,"filter-input",3,"ngModelChange","input","ngModel"],[1,"filter-select",3,"ngModelChange","change","ngModel"],["value",""],["value","active"],["value","blocked"],[3,"value",4,"ngFor","ngForOf"],[1,"table-container"],[2,"width","300px"],[2,"width","70px"],[2,"width","120px"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"invite-btn",3,"click"],[1,"modal-backdrop"],[1,"modal"],[3,"ngSubmit"],["for","domain"],["id","domain","name","domain","required","",3,"ngModelChange","ngModel"],["value","duoc.cl"],["value","duocuc.cl"],["value","profesor.duoc.cl"],["for","username"],["type","text","id","username","name","username","required","",3,"ngModelChange","ngModel"],["for","confirmUsername"],["type","text","id","confirmUsername","name","confirmUsername","required","",3,"ngModelChange","ngModel"],["class","error-message",4,"ngIf"],["class","loading-message",4,"ngIf"],[1,"modal-actions"],["type","submit",1,"send-btn",3,"disabled"],["type","button",1,"cancel-btn",3,"click","disabled"],[1,"error-message"],[1,"loading-message"],[3,"value"],[3,"ngClass"],[1,"permissions-container"],[3,"background-color",4,"ngFor","ngForOf"],["class","action-btn block-btn",3,"click",4,"ngIf"],["class","action-btn edit-btn",3,"click",4,"ngIf"],["class","delete-container",4,"ngIf"],[1,"action-btn","block-btn",3,"click"],[1,"action-btn","edit-btn",3,"click"],[1,"delete-container"],["type","checkbox",3,"ngModelChange","change","ngModel","disabled"],[1,"delete-btn",3,"click","disabled"],[1,"fa","fa-trash"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"h2",1),c(2,"Administrador de Usuarios"),s(),u(3,Ne,2,0,"button",2)(4,De,27,7,"div",3),a(5,"div",4)(6,"input",5),w("ngModelChange",function(r){return M(n.searchQuery,r)||(n.searchQuery=r),r}),_("input",function(){return n.applyFilters()}),s(),a(7,"select",6),w("ngModelChange",function(r){return M(n.filterStatus,r)||(n.filterStatus=r),r}),_("change",function(){return n.applyFilters()}),a(8,"option",7),c(9,"Todos"),s(),a(10,"option",8),c(11,"Activos"),s(),a(12,"option",9),c(13,"Bloqueados"),s()(),a(14,"select",6),w("ngModelChange",function(r){return M(n.filterPermission,r)||(n.filterPermission=r),r}),_("change",function(){return n.applyFilters()}),a(15,"option",7),c(16,"Todos los permisos"),s(),u(17,Ae,2,2,"option",10),s()(),a(18,"div",11)(19,"table")(20,"thead")(21,"tr")(22,"th"),c(23,"ID"),s(),a(24,"th",12),c(25,"Correo Electr\xF3nico"),s(),a(26,"th",13),c(27,"Estado"),s(),a(28,"th"),c(29,"Permisos"),s(),a(30,"th",14),c(31,"Acciones"),s(),a(32,"th",13),c(33,"Eliminar"),s()()(),a(34,"tbody"),u(35,He,15,13,"tr",15),s()()()()),e&2&&(l(3),p("ngIf",n.hasPermission(S(7,Ie))),l(),p("ngIf",n.showInviteModal),l(2),y("ngModel",n.searchQuery),l(),y("ngModel",n.filterStatus),l(7),y("ngModel",n.filterPermission),l(3),p("ngForOf",n.allPermissions),l(18),p("ngForOf",n.filteredUsers))},dependencies:[U,B,D,A,H,he,ve,Ce,ue,pe,xe,_e,ge,Pe,be,fe],styles:['@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Light.ttf) format("truetype");font-weight:300;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-LightItalic.ttf) format("truetype");font-weight:300;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Black.ttf) format("truetype");font-weight:900;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BlackItalic.ttf) format("truetype");font-weight:900;font-style:italic}.users-list-container[_ngcontent-%COMP%]{width:100%;max-width:1800px;margin:0 auto;padding:20px;background-color:#fff;border-radius:10px;box-shadow:0 4px 10px #0000001a;box-sizing:border-box;overflow:hidden}.tittle[_ngcontent-%COMP%]{font-size:24px;margin:0;display:inline}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}h2.tittle[_ngcontent-%COMP%]{margin:0;font-size:24px}.invite-btn[_ngcontent-%COMP%]{align-items:right;display:flex;padding:25px;background-color:#28a745;color:#fff;height:80px;border:none;border-radius:25px;cursor:pointer;font-size:24px;transition:background-color .3s ease;margin-left:auto;margin-bottom:20px}.invite-btn[_ngcontent-%COMP%]:hover{background-color:#218838}.filter-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;gap:20px;margin-bottom:20px}.filter-input[_ngcontent-%COMP%]{padding:8px 12px;border-radius:5px;border:1px solid #ccc;outline:none;width:300px;transition:border-color .3s ease}.filter-select[_ngcontent-%COMP%]{padding:8px 12px;border-radius:5px;border:1px solid #ccc;outline:none;transition:border-color .3s ease}.filter-input[_ngcontent-%COMP%]:focus, .filter-select[_ngcontent-%COMP%]:focus{border-color:#007bff}.table-container[_ngcontent-%COMP%]{width:100%;overflow-x:auto;box-sizing:border-box}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%]{padding:10px;background-color:#34495e;color:#fff}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#f7f7f7}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:#eee}tbody[_ngcontent-%COMP%]   tr.blocked[_ngcontent-%COMP%]{background-color:#f8d7da}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px;text-align:left;border-bottom:1px solid #ddd}.permissions-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:5px;max-height:100px;overflow-y:auto;background-color:#fff;padding:5px;border-radius:5px;box-sizing:border-box}.permissions-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:5px;border-radius:3px;color:#000;font-size:12px;background-color:#f1f1f1}.permission-global[_ngcontent-%COMP%]{background-color:gold}.permission-users[_ngcontent-%COMP%]{background-color:#ff0}.permission-faqs[_ngcontent-%COMP%]{background-color:red;color:#fff}.action-btn[_ngcontent-%COMP%]{display:block;width:100%;margin-bottom:10px;color:#fff;border:none;padding:8px;border-radius:4px;cursor:pointer}.block-btn[_ngcontent-%COMP%]{background-color:#dc3545}.block-btn[_ngcontent-%COMP%]:hover{background-color:#c82333}.unblock-btn[_ngcontent-%COMP%]{background-color:#28a745}.unblock-btn[_ngcontent-%COMP%]:hover{background-color:#218838}.edit-btn[_ngcontent-%COMP%]{background-color:#007bff}.edit-btn[_ngcontent-%COMP%]:hover{background-color:#0056b3}.delete-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px}.delete-btn[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:5px;border-radius:4px;cursor:pointer;width:100%}.delete-btn[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.delete-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#c82333}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center}.modal[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:10px;width:90%;max-width:400px;box-shadow:0 4px 10px #0003}.modal[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:20px}.modal[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:700}.modal[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .modal[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:10px;margin-bottom:15px;border:1px solid #ccc;border-radius:5px;box-sizing:border-box}.error-message[_ngcontent-%COMP%]{color:red;font-size:12px;margin-bottom:10px}.loading-message[_ngcontent-%COMP%]{font-size:14px;color:#007bff;margin-bottom:10px}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.send-btn[_ngcontent-%COMP%]{background-color:#28a745;color:#fff;border:none;padding:10px 20px;border-radius:5px;cursor:pointer}.send-btn[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.cancel-btn[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:10px 20px;border-radius:5px;cursor:pointer}.cancel-btn[_ngcontent-%COMP%]:hover{background-color:#c82333}']})};var J=class o{constructor(t,e){this.http=t;this.renewService=e}apiUrl=j.apiUrl;getAllPermissions(t){let e=localStorage.getItem("accessToken"),n=new P({Authorization:`Bearer ${e}`});return this.http.get(`${this.apiUrl}administrator/permission/all?id_user=${t}`,{headers:n}).pipe(v(i=>this.renewService.handleTokenError(i,()=>this.getAllPermissions(t))))}assignPermission(t,e,n,i,r){let d=localStorage.getItem("accessToken"),h=new P({Authorization:`Bearer ${d}`}),X={user_id:t,permission_id:e,id_faq_category:n,id_collaborator_category:i,id_info:r};return this.http.post(`${this.apiUrl}administrator/permission/assign`,X,{headers:h}).pipe(v(Y=>this.renewService.handleTokenError(Y,()=>this.assignPermission(t,e,n,i,r))))}removePermission(t,e,n,i,r){let d=localStorage.getItem("accessToken"),h=new P({Authorization:`Bearer ${d}`}),X={user_id:t,permission_id:e,id_faq_category:n,id_collaborator_category:i,id_info:r};return this.http.request("delete",`${this.apiUrl}administrator/permission/remove`,{headers:h,body:X}).pipe(v(Y=>this.renewService.handleTokenError(Y,()=>this.removePermission(t,e,n,i,r))))}static \u0275fac=function(e){return new(e||o)(O(R),O(z))};static \u0275prov=L({token:o,factory:o.\u0275fac,providedIn:"root"})};var ye=(o,t)=>({active:o,inactive:t});function Qe(o,t){if(o&1){let e=b();a(0,"li")(1,"a",3),_("click",function(){let i=g(e).$implicit,r=m();return f(r.navigateToModule(i.module))}),c(2),s()()}if(o&2){let e=t.$implicit;l(2),x(e.module)}}function Je(o,t){if(o&1&&(a(0,"th"),c(1),ne(2,"uppercase"),s()),o&2){let e=t.$implicit;l(),x(ie(2,1,e))}}function Ge(o,t){if(o&1){let e=b();a(0,"button",25),_("click",function(){let i;g(e);let r=m(2).$implicit,d=m(2).$implicit,h=m();return f(h.assignPermission((i=d.permissions[r]==null?null:d.permissions[r].permission_id)!==null&&i!==void 0?i:0,(i=d.permissions[r]==null?null:d.permissions[r].id_faq_category)!==null&&i!==void 0?i:null,(i=d.permissions[r]==null?null:d.permissions[r].id_collaborator_category)!==null&&i!==void 0?i:null,(i=d.permissions[r]==null?null:d.permissions[r].id_info)!==null&&i!==void 0?i:null))}),c(1," Asociar Permiso "),s()}}function Ke(o,t){if(o&1){let e=b();a(0,"button",26),_("click",function(){let i;g(e);let r=m(2).$implicit,d=m(2).$implicit,h=m();return f(h.removePermission((i=d.permissions[r]==null?null:d.permissions[r].permission_id)!==null&&i!==void 0?i:0,(i=d.permissions[r]==null?null:d.permissions[r].id_faq_category)!==null&&i!==void 0?i:null,(i=d.permissions[r]==null?null:d.permissions[r].id_collaborator_category)!==null&&i!==void 0?i:null,(i=d.permissions[r]==null?null:d.permissions[r].id_info)!==null&&i!==void 0?i:null))}),c(1," Eliminar Permiso "),s()}}function Xe(o,t){if(o&1&&(a(0,"div",19)(1,"p",20)(2,"strong"),c(3,"Nombre:"),s(),c(4),s(),a(5,"p",21)(6,"strong"),c(7,"Detalles:"),s(),c(8),s(),a(9,"div",22),u(10,Ge,2,0,"button",23)(11,Ke,2,0,"button",24),s()()),o&2){let e=m().$implicit,n=m(2).$implicit,i=m();p("ngClass",te(5,ye,n.permissions[e]==null?null:n.permissions[e].hasPermission,!(n.permissions[e]!=null&&n.permissions[e].hasPermission))),l(4),C(" ",(n.permissions[e]==null?null:n.permissions[e].permission_name)||"No disponible",""),l(4),C(" ",(n.permissions[e]==null?null:n.permissions[e].permission_details)||"No disponible",""),l(2),p("ngIf",!(n.permissions[e]!=null&&n.permissions[e].hasPermission)&&i.hasPermission(14)),l(),p("ngIf",(n.permissions[e]==null?null:n.permissions[e].hasPermission)&&i.hasPermission(14))}}function Ye(o,t){o&1&&(a(0,"div")(1,"p"),c(2,"No disponible"),s()())}function Ze(o,t){if(o&1&&(a(0,"td",16),u(1,Xe,12,8,"div",17)(2,Ye,3,0,"div",18),s()),o&2){let e=t.$implicit,n=m(2).$implicit;l(),p("ngIf",n.permissions&&n.permissions[e]),l(),p("ngIf",!n.permissions||!n.permissions[e])}}function et(o,t){if(o&1&&(a(0,"div",14)(1,"table")(2,"thead")(3,"tr"),u(4,Je,3,3,"th",7),s()(),a(5,"tbody")(6,"tr"),u(7,Ze,3,2,"td",15),s()()()()),o&2){let e=m().$implicit;l(4),p("ngForOf",e.columns),l(3),p("ngForOf",e.columns)}}function tt(o,t){if(o&1&&(a(0,"th"),c(1),ne(2,"uppercase"),s()),o&2){let e=t.$implicit;l(),x(ie(2,1,e))}}function nt(o,t){if(o&1){let e=b();a(0,"button",3),_("click",function(){let i;g(e);let r=m(2).$implicit,d=m().$implicit,h=m(3);return f(h.assignPermission((i=d.permissions[r]==null?null:d.permissions[r].permission_id)!==null&&i!==void 0?i:0,(i=d.permissions[r]==null?null:d.permissions[r].id_faq_category)!==null&&i!==void 0?i:null,(i=d.permissions[r]==null?null:d.permissions[r].id_collaborator_category)!==null&&i!==void 0?i:null,(i=d.permissions[r]==null?null:d.permissions[r].id_info)!==null&&i!==void 0?i:null))}),c(1," Asociar Permiso "),s()}}function it(o,t){if(o&1){let e=b();a(0,"button",26),_("click",function(){let i;g(e);let r=m(2).$implicit,d=m().$implicit,h=m(3);return f(h.removePermission((i=d.permissions[r]==null?null:d.permissions[r].permission_id)!==null&&i!==void 0?i:0,(i=d.permissions[r]==null?null:d.permissions[r].id_faq_category)!==null&&i!==void 0?i:null,(i=d.permissions[r]==null?null:d.permissions[r].id_collaborator_category)!==null&&i!==void 0?i:null,(i=d.permissions[r]==null?null:d.permissions[r].id_info)!==null&&i!==void 0?i:null))}),c(1," Eliminar Permiso "),s()}}function rt(o,t){if(o&1&&(a(0,"div",19)(1,"p",20)(2,"strong"),c(3,"Nombre:"),s(),c(4),s(),a(5,"p",21)(6,"strong"),c(7,"Detalles:"),s(),c(8),s(),a(9,"div",22),u(10,nt,2,0,"button",28)(11,it,2,0,"button",24),s()()),o&2){let e=m().$implicit,n=m().$implicit,i=m(3);p("ngClass",te(5,ye,n.permissions[e]==null?null:n.permissions[e].hasPermission,!(n.permissions[e]!=null&&n.permissions[e].hasPermission))),l(4),C(" ",(n.permissions[e]==null?null:n.permissions[e].permission_name)||"No disponible",""),l(4),C(" ",(n.permissions[e]==null?null:n.permissions[e].permission_details)||"No disponible",""),l(2),p("ngIf",!(n.permissions[e]!=null&&n.permissions[e].hasPermission)&&i.hasPermission(14)),l(),p("ngIf",(n.permissions[e]==null?null:n.permissions[e].hasPermission)&&i.hasPermission(14))}}function ot(o,t){o&1&&(a(0,"div")(1,"p"),c(2,"No disponible"),s()())}function st(o,t){if(o&1&&(a(0,"td"),u(1,rt,12,8,"div",17)(2,ot,3,0,"div",18),s()),o&2){let e=t.$implicit,n=m().$implicit;l(),p("ngIf",n.permissions[e]),l(),p("ngIf",!n.permissions[e])}}function at(o,t){if(o&1&&(oe(0),a(1,"tr")(2,"td",27),c(3),s(),u(4,st,3,2,"td",7),s(),se()),o&2){let e=t.$implicit,n=m(2).$implicit;l(3),x(e.category_name||e.information_title),l(),p("ngForOf",n.columns)}}function lt(o,t){if(o&1&&(a(0,"div",14)(1,"table")(2,"thead")(3,"tr")(4,"th"),c(5,"Categor\xEDa"),s(),u(6,tt,3,3,"th",7),s()(),a(7,"tbody"),u(8,at,5,2,"ng-container",7),s()()()),o&2){let e=m().$implicit;l(6),p("ngForOf",e.columns),l(2),p("ngForOf",e.rows)}}function ct(o,t){if(o&1&&(a(0,"div",11)(1,"h2",12),c(2),s(),a(3,"p"),c(4),s(),u(5,et,8,2,"div",13)(6,lt,9,2,"div",13),s()),o&2){let e=t.$implicit;ae("id",e.module),l(2),C(" ",e.module," "),l(2),x(e.description),l(),p("ngIf",e.isModular),l(),p("ngIf",!e.isModular)}}var G=class o{constructor(t,e,n){this.route=t;this.permissionService=e;this.router=n}userId=0;modules=[];isAdminUser=!1;errorMessage="";loading=!1;successMessage="";showSuccessMessage=!1;displayUsername="";ngOnInit(){this.route.paramMap.subscribe(t=>{this.userId=Number(t.get("userId"))}),this.route.queryParams.subscribe(t=>{let e=t.username;e&&(this.displayUsername=e)}),this.checkAdminPermissions(),this.userId&&this.loadPermissions()}checkAdminPermissions(){let t=localStorage.getItem("userDetails");if(t){let e=JSON.parse(t).permissionsDetails;this.isAdminUser=e.some(n=>n.id_permission===1||n.id_permission===3)}}hasPermission(t){let e=localStorage.getItem("userDetails");return e?JSON.parse(e).permissionsDetails.some(i=>i.id_permission===t)||this.isAdminUser:this.isAdminUser}loadPermissions(){this.permissionService.getAllPermissions(this.userId).subscribe(t=>{t.success&&t.permissions&&(this.modules=t.permissions.map(e=>({module:e.module,description:e.description??"Sin descripci\xF3n",columns:e.columns??[],permissions:e.permissions??{},rows:e.rows??[],isModular:e.isModular,isExpanded:!1})))},t=>{console.error("Error al cargar permisos",t),this.errorMessage="Error al cargar permisos."})}goBackToUsers(){this.router.navigate(["/users"])}navigateToModule(t){window.location.hash=t}scrollToFragment(t){if(t){let e=document.getElementById(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}}scrollToTop(){let t=document.getElementById("titulo");t&&t.scrollIntoView({behavior:"smooth",block:"start"})}toggleModuleExpansion(t){t.isExpanded=!t.isExpanded}assignPermission(t,e,n,i){t&&this.permissionService.assignPermission(this.userId,t,e,n,i).subscribe(()=>{this.showSuccess("Permiso asociado"),this.loadPermissions()},r=>{console.error("Error al asociar permiso",r)})}removePermission(t,e,n,i){t&&this.permissionService.removePermission(this.userId,t,e,n,i).subscribe(()=>{this.showSuccess("Permiso eliminado"),this.loadPermissions()},r=>{console.error("Error al eliminar permiso",r)})}showSuccess(t){this.successMessage=t,this.showSuccessMessage=!0,setTimeout(()=>{this.showSuccessMessage=!1},3e3)}static \u0275fac=function(e){return new(e||o)(k(me),k(J),k(q))};static \u0275cmp=F({type:o,selectors:[["app-edit-user-permissions"]],standalone:!0,features:[$],decls:14,vars:4,consts:[[1,"permissions-container"],["id","titulo",1,"header-container"],[1,"back-to-users"],[3,"click"],[1,"fa","fa-arrow-left"],[1,"title"],[1,"module-index"],[4,"ngFor","ngForOf"],["class","module-container",3,"id",4,"ngFor","ngForOf"],[1,"back-to-top",3,"click"],[1,"fa","fa-arrow-up"],[1,"module-container",3,"id"],[1,"toggle-header"],["class","table-container",4,"ngIf"],[1,"table-container"],["style","width: 150px;",4,"ngFor","ngForOf"],[2,"width","150px"],[3,"ngClass",4,"ngIf"],[4,"ngIf"],[3,"ngClass"],[1,"name"],[1,"details"],[1,"button-container"],["class","add-btn",3,"click",4,"ngIf"],["class","delete-btn",3,"click",4,"ngIf"],[1,"add-btn",3,"click"],[1,"delete-btn",3,"click"],[1,"category_name"],[3,"click",4,"ngIf"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),_("click",function(){return n.goBackToUsers()}),E(4,"i",4),c(5," Volver "),s()(),a(6,"h1",5),c(7),s()(),a(8,"nav",6)(9,"ul"),u(10,Qe,3,1,"li",7),s()(),u(11,ct,7,5,"div",8),a(12,"button",9),_("click",function(){return n.scrollToTop()}),E(13,"i",10),s()()),e&2&&(l(7),le("Permisos del Usuario ",n.userId,": ",n.displayUsername,""),l(3),p("ngForOf",n.modules),l(),p("ngForOf",n.modules))},dependencies:[U,B,D,A,de,H],styles:['@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Light.ttf) format("truetype");font-weight:300;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-LightItalic.ttf) format("truetype");font-weight:300;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Black.ttf) format("truetype");font-weight:900;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BlackItalic.ttf) format("truetype");font-weight:900;font-style:italic}.permissions-container[_ngcontent-%COMP%]{max-width:100%;margin:20px;background-color:#fff;padding:20px;border-radius:8px;box-shadow:0 4px 8px #0000001a}.header-container[_ngcontent-%COMP%]{display:flex;align-items:left;margin-bottom:20px}.back-to-users[_ngcontent-%COMP%]{margin-right:auto}.back-to-users[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#f0ad4e;color:#fff;border:none;padding:15px 25px;border-radius:5px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px}.back-to-users[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px;margin-right:8px}.back-to-users[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#ec971f}.title[_ngcontent-%COMP%]{text-align:left;margin:0 0 0 50px;flex-grow:1}.module-container[_ngcontent-%COMP%]{margin-bottom:20px}.table-container[_ngcontent-%COMP%]{width:100%;margin-top:10px}table[_ngcontent-%COMP%]{width:auto;border-collapse:collapse;background-color:#f9f9f9;border:1px solid #ccc}th[_ngcontent-%COMP%]{background-color:#f2f2f2;padding:10px;text-align:left;cursor:pointer}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{padding:10px;border:1px solid #ddd;word-wrap:break-word;vertical-align:top}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#f9f9f9;max-height:250px;min-height:250px}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}td[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:10px;border-radius:5px;text-align:left;min-width:200px;max-width:200px;display:flex;flex-direction:column;justify-content:space-between;height:250px;overflow:hidden;position:relative}.category_name[_ngcontent-%COMP%]{padding-top:100px;overflow:hidden;font-size:20px;font-weight:600;max-width:100px}.name[_ngcontent-%COMP%], .details[_ngcontent-%COMP%]{overflow-y:auto;margin:0;min-height:100px;max-height:100px;padding-right:10px}td[_ngcontent-%COMP%]   div.active[_ngcontent-%COMP%]{background-color:#eaffea;border:1px solid green}td[_ngcontent-%COMP%]   div.inactive[_ngcontent-%COMP%]{background-color:#ffeaea;border:1px solid red}.button-container[_ngcontent-%COMP%]{text-align:center;margin-top:auto;position:absolute;bottom:10px;left:50%;transform:translate(-50%);width:90%}button[_ngcontent-%COMP%]{padding:10px;background-color:#007bff;text-align:center;font-size:20px;height:40px;color:#fff;border:none;border-radius:15px;cursor:pointer;width:100%}button.delete-btn[_ngcontent-%COMP%]{background-color:red}button.add-btn[_ngcontent-%COMP%]{background-color:#10a500}button.add-btn[_ngcontent-%COMP%]:hover{background-color:#075700}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}button.delete-btn[_ngcontent-%COMP%]:hover{background-color:#8b0000}button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f1f1f1;font-weight:700}.toggle-header[_ngcontent-%COMP%]{cursor:pointer;display:flex;align-items:center;justify-content:space-between;padding:10px;background-color:#f9f9f9;border:1px solid #ddd;border-radius:5px}.toggle-icon[_ngcontent-%COMP%]{margin-left:10px;font-size:16px}.success-message[_ngcontent-%COMP%]{background-color:#dff0d8;color:#3c763d;padding:10px;border-radius:5px;margin-bottom:20px;font-size:14px}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100px}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(0,0,0,.1);border-left-color:#007bff;border-radius:50%;width:40px;height:40px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.back-to-top[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:75px;z-index:1000;background-color:#f4ff8e;color:#000;border:none;padding:15px;border-radius:50%;cursor:pointer;box-shadow:0 4px 8px #0003;max-width:75px;min-width:75px;max-height:75px;min-height:75px}.back-to-top[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px}.back-to-top[_ngcontent-%COMP%]:hover{background-color:#0056b3}.module-index[_ngcontent-%COMP%]{background-color:#f9f9f9;padding:8px;border-radius:8px;box-shadow:0 4px 8px #0000001a;max-width:250px;margin:50px auto;text-align:center}.module-index[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0}.module-index[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:5px}.module-index[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{width:90%;display:inline-block;padding:8px;color:#007bff;text-decoration:none;font-weight:700;border-radius:5px;transition:background-color .3s,color .3s,cursor .3s}.module-index[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#ff0;color:#000;cursor:pointer}']})};var dt=[{path:"",component:Q},{path:"permission/:userId",component:G}],K=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=N({type:o});static \u0275inj=V({imports:[I.forChild(dt),I]})};var Me=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=N({type:o});static \u0275inj=V({imports:[U,K,I.forChild([])]})};export{Me as UsersModule};
