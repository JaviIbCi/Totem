import './polyfills.server.mjs';
import{a as R}from"./chunk-DDWXLKST.mjs";import"./chunk-MYRRTMDS.mjs";import{b as T,c as C,d as V,e as D,h as z,k as B,l as L,s as U,t as A,u as j}from"./chunk-7Q4IHH5Z.mjs";import"./chunk-NEDADJCY.mjs";import{p as k}from"./chunk-ZW4IHJJG.mjs";import{Ab as w,Dc as S,Ga as h,Gb as O,Ia as l,Ja as v,Jb as P,Wa as u,_a as d,ca as M,fb as a,gb as r,hb as _,kb as b,la as p,ma as f,mb as g,ob as c,rb as y,xc as E,yb as m,yc as I,zb as N,zc as F}from"./chunk-EC3LRZMX.mjs";import"./chunk-5XUXGTUW.mjs";var $=(i,t)=>({"bg-light":i,"automatic-news":t});function q(i,t){i&1&&(a(0,"div",19),m(1," Para reordenar las noticias, haga clic y arrastre la tarjeta a la posici\xF3n deseada. "),r())}function W(i,t){i&1&&(a(0,"p",20),m(1," Esta es una noticia autom\xE1tica generada a partir de una publicaci\xF3n de Instagram. "),r())}function Y(i,t){if(i&1&&(a(0,"div"),_(1,"img",21),r()),i&2){let e=c().$implicit;l(),y("alt",e.caption),d("src",e.media_url,h)}}function H(i,t){if(i&1&&(a(0,"div"),_(1,"video",22),r()),i&2){let e=c().$implicit;l(),d("src",e.media_url,h)}}function J(i,t){if(i&1){let e=b();a(0,"button",23),g("click",function(){p(e);let o=c().$implicit,s=c();return f(s.openEditModal(o))}),m(1," Editar "),r()}}function K(i,t){if(i&1){let e=b();a(0,"div",9),g("dragstart",function(o){let s=p(e).index,x=c();return f(x.onDragStart(o,s))})("dragover",function(o){p(e);let s=c();return f(s.onDragOver(o))})("drop",function(o){let s=p(e).index,x=c();return f(x.onDrop(o,s))}),a(1,"button",10),g("click",function(){let o=p(e).index,s=c();return f(s.toggleInstructions(o))})("mouseleave",function(){let o=p(e).index,s=c();return f(s.hideInstructions(o))}),m(2),r(),u(3,q,2,0,"div",11),a(4,"h4",12),m(5),r(),u(6,W,2,0,"p",13),a(7,"div",14),u(8,Y,2,2,"div",15)(9,H,2,1,"div",15),r(),a(10,"div",16),u(11,J,2,0,"button",17),a(12,"button",18),g("click",function(){let o=p(e).$implicit,s=c();return f(s.deleteNews(o.id_news))}),m(13," Eliminar "),r()()()}if(i&2){let e=t.$implicit,n=t.index,o=c();d("ngClass",P(8,$,!e.is_automatic,e.is_automatic)),l(2),w(" ",n+1," "),l(),d("ngIf",o.instructionsVisible[n]),l(2),N(e.caption),l(),d("ngIf",e.is_automatic),l(2),d("ngIf",(e.media_type==null?null:e.media_type.toLowerCase())==="image"&&e.media_url),l(),d("ngIf",(e.media_type==null?null:e.media_type.toLowerCase())==="video"&&e.media_url),l(2),d("ngIf",!e.is_automatic&&!e.is_from_instagram)}}function Q(i,t){if(i&1&&(a(0,"div",24),m(1),r()),i&2){let e=c();l(),w(" \u2714\uFE0F ",e.successMessage," ")}}function X(i,t){if(i&1&&(a(0,"div",25),m(1),r()),i&2){let e=c();l(),w(" \u26A0\uFE0F ",e.errorMessage," ")}}function Z(i,t){if(i&1&&(a(0,"div",45)(1,"strong"),m(2,"Archivo seleccionado:"),r(),m(3),r()),i&2){let e=c(2);l(3),w(" ",e.fileName," ")}}function ee(i,t){if(i&1&&(a(0,"div"),_(1,"img",47),r()),i&2){let e=c(3);l(),d("src",e.mediaPreviewUrl,h)}}function te(i,t){if(i&1&&(a(0,"div"),_(1,"video",48),r()),i&2){let e=c(3);l(),d("src",e.mediaPreviewUrl,h)}}function ie(i,t){if(i&1&&(a(0,"div",46),u(1,ee,2,1,"div",15)(2,te,2,1,"div",15),r()),i&2){let e=c(2);l(),d("ngIf",e.isImage()),l(),d("ngIf",e.isVideo())}}function ne(i,t){if(i&1){let e=b();a(0,"div",26)(1,"div",27)(2,"span",28),g("click",function(){p(e);let o=c();return f(o.closeModal())}),m(3,"\xD7"),r(),a(4,"h3",29),m(5),r(),a(6,"form",30),g("ngSubmit",function(){p(e);let o=c();return f(o.onSubmit())}),a(7,"div",31)(8,"label",32),m(9,"T\xEDtulo de la noticia"),r(),_(10,"input",33),r(),a(11,"div",31)(12,"label",34),m(13,"Enlace (opcional)"),r(),_(14,"input",35),r(),a(15,"div",36)(16,"label",37),m(17,"Archivo de imagen o video"),r(),a(18,"div",38)(19,"input",39),g("change",function(o){p(e);let s=c();return f(s.onFileSelect(o))}),r(),a(20,"label",40)(21,"span",41),m(22,"\u{1F4C1}"),r(),m(23," Seleccionar archivo "),r()(),u(24,Z,4,1,"div",42),r(),u(25,ie,3,2,"div",43),a(26,"button",44),m(27),r()()()()}if(i&2){let e=c();l(5),w(" ",e.isEditing?"Editar Noticia":"Crear Nueva Noticia"," "),l(),d("formGroup",e.newsForm),l(18),d("ngIf",e.fileName),l(),d("ngIf",e.mediaPreviewUrl),l(2),w(" ",e.isEditing?"Actualizar Noticia":"Agregar Noticia"," ")}}var G=class i{constructor(t,e,n){this.newsService=t;this.fb=e;this.router=n;this.newsForm=this.fb.group({caption:["",C.required],permalink:[""],file:[null,C.required]})}newsForm;newsList=[];activeMessage=!1;successMessage="";errorMessage="";isEditing=!1;currentEditingId=null;is_automatic;showModal=!1;instructionsVisible=[];mediaPreviewUrl=null;fileName=null;mediaBaseUrl="https://totemvespucio.cl/assets/news";ngOnInit(){this.loadNews()}toggleInstructions(t){this.instructionsVisible[t]=!this.instructionsVisible[t]}hideInstructions(t){this.instructionsVisible[t]=!1}onDragStart(t,e){t.dataTransfer?.setData("text",e.toString());let n=t.target;n&&n.classList.add("dragging")}onDragOver(t){t.preventDefault()}onDrop(t,e){t.preventDefault();let n=t.target;n&&n.classList.remove("dragging");let o=t.dataTransfer?.getData("text");if(o!==void 0){let s=parseInt(o,10);if(!isNaN(s)&&s!==e){let x=this.newsList.splice(s,1)[0];this.newsList.splice(e,0,x),this.reorderNews()}}}goToInstagramModule(){this.router.navigate(["/news-instagram"]).catch(t=>{console.error("Error en la navegaci\xF3n a /news-instagram:",t)})}loadNews(){this.newsService.getAllNews().subscribe(t=>{this.newsList=t.data.map(e=>(e.media_url&&!e.media_url.startsWith("http")&&(e.media_url=`${this.mediaBaseUrl}${e.media_url}`),e.is_from_instagram=!!e.id_instagram,e.is_automatic=e.is_automatic??!1,e))},t=>{this.showTemporaryMessage("error","Error al cargar las noticias")})}isImage(){let t=this.newsForm.get("file")?.value;return t?t.type.startsWith("image"):!1}isVideo(){let t=this.newsForm.get("file")?.value;return t?t.type.startsWith("video"):!1}onFileSelect(t){let e=t.target.files[0];if(this.fileName=e?.name??null,e){let n=new FileReader;n.onload=o=>{this.mediaPreviewUrl=o.target?.result},n.readAsDataURL(e)}else this.mediaPreviewUrl=null;this.newsForm.patchValue({file:e})}showTemporaryMessage(t,e,n=5e3){t==="success"?this.successMessage=e:t==="error"&&(this.errorMessage=e),this.activeMessage=!0,setTimeout(()=>{this.activeMessage=!1,t==="success"?this.successMessage="":t==="error"&&(this.errorMessage="")},n)}onSubmit(){let t=new FormData;t.append("caption",this.newsForm.get("caption")?.value),t.append("permalink",this.newsForm.get("permalink")?.value||""),this.newsForm.get("file")?.value&&t.append("file",this.newsForm.get("file")?.value),this.isEditing&&this.currentEditingId!==null?this.newsService.updateOwnNews(this.currentEditingId,t).subscribe(()=>{this.loadNews(),this.resetForm(),this.showTemporaryMessage("success","Noticia actualizada correctamente")},e=>{console.error("Error al actualizar la noticia:",e),this.showTemporaryMessage("error","Error al actualizar la noticia")}):this.newsService.createOwnNews(t).subscribe(()=>{this.loadNews(),this.resetForm(),this.showTemporaryMessage("success","Noticia creada correctamente")},e=>{console.error("Error al agregar la noticia:",e),this.showTemporaryMessage("error","Error al agregar la noticia")}),this.closeModal()}openCreateModal(){this.resetForm(),this.showModal=!0,this.isEditing=!1}openEditModal(t){this.isEditing=!0,this.currentEditingId=t.id_news,this.newsForm.patchValue({caption:t.caption,permalink:t.permalink||"",file:null}),this.showModal=!0}closeModal(){this.showModal=!1}deleteNews(t){confirm("\xBFEst\xE1s seguro de eliminar esta noticia?")&&this.newsService.deleteNews(t).subscribe(()=>{this.loadNews(),this.showTemporaryMessage("success","Noticia eliminada correctamente")},e=>{console.error("Error al eliminar la noticia:",e),this.showTemporaryMessage("error","Error al eliminar la noticia")})}reorderNews(){let t=this.newsList.map(e=>e.id_news);this.newsService.reorderNews(t).subscribe(()=>{this.showTemporaryMessage("success","Noticias reordenadas con \xE9xito")},e=>{console.error("Error al reordenar las noticias:",e),this.showTemporaryMessage("error","Error al reordenar las noticias")})}resetForm(){this.newsForm.reset(),this.isEditing=!1,this.currentEditingId=null,this.successMessage="",this.errorMessage="",this.mediaPreviewUrl=null}hasPermission(t,e){let n=localStorage.getItem("userDetails");if(n){let o=JSON.parse(n).permissionsDetails;return e?o.some(s=>s.id_permission===t&&s.faq_category?.id_faq_category===e||s.id_permission===1||s.id_permission===5):o.some(s=>s.id_permission===t||s.id_permission===1||s.id_permission===5)}return!1}static \u0275fac=function(e){return new(e||i)(v(R),v(U),v(k))};static \u0275cmp=M({type:i,selectors:[["app-news-common"]],standalone:!0,features:[O],decls:12,vars:4,consts:[[1,"container-fluid"],[1,"text-center","text-primary"],[1,"btn","btn-info","mt-4",3,"click"],[1,"btn","btn-primary","mt-4",3,"click"],[1,"news-grid","mt-5"],["class","news-item p-3 border rounded shadow-sm position-relative","draggable","true",3,"ngClass","dragstart","dragover","drop",4,"ngFor","ngForOf"],["class","alert alert-success text-center alert-confirmation fixed-center",4,"ngIf"],["class","alert alert-danger text-center alert-confirmation fixed-center",4,"ngIf"],["class","modal-overlay",4,"ngIf"],["draggable","true",1,"news-item","p-3","border","rounded","shadow-sm","position-relative",3,"dragstart","dragover","drop","ngClass"],[1,"btn","btn-light","btn-sm","position-absolute","top-0","end-0","mt-2","me-2",3,"click","mouseleave"],["class","instructions-popup mt-2",4,"ngIf"],[1,"text-secondary","mt-4"],["class","small text-muted mt-2",4,"ngIf"],[1,"media-container","mt-3"],[4,"ngIf"],[1,"mt-3"],["class","btn btn-warning me-2",3,"click",4,"ngIf"],[1,"btn","btn-danger",3,"click"],[1,"instructions-popup","mt-2"],[1,"small","text-muted","mt-2"],[1,"img-fluid","rounded","shadow-sm",3,"src","alt"],["controls","",1,"mt-2","rounded","shadow-sm",3,"src"],[1,"btn","btn-warning","me-2",3,"click"],[1,"alert","alert-success","text-center","alert-confirmation","fixed-center"],[1,"alert","alert-danger","text-center","alert-confirmation","fixed-center"],[1,"modal-overlay"],[1,"modal-content"],[1,"close-button",3,"click"],[1,"modal-title"],[1,"form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","caption",1,"form-label"],["type","text","id","caption","formControlName","caption",1,"form-input-large"],["for","permalink",1,"form-label"],["type","text","id","permalink","formControlName","permalink",1,"form-input-large"],[1,"form-group","modern-file-upload"],["for","file",1,"form-label"],[1,"file-input-wrapper"],["type","file","id","file",1,"form-input-file",3,"change"],["for","file",1,"file-input-label"],[1,"icon"],["class","file-name",4,"ngIf"],["class","media-preview",4,"ngIf"],["type","submit",1,"btn","btn-success","action-button","w-100","mt-4"],[1,"file-name"],[1,"media-preview"],["alt","Vista previa de la imagen",1,"img-preview",3,"src"],["controls","",1,"video-preview",3,"src"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"h2",1),m(2," Gestor de Noticias - \xDAltimas Novedades "),r(),a(3,"button",2),g("click",function(){return n.goToInstagramModule()}),m(4," Ver Publicaciones de Instagram "),r(),a(5,"button",3),g("click",function(){return n.openCreateModal()}),m(6," Crear Nueva Noticia "),r(),a(7,"div",4),u(8,K,14,11,"div",5),r(),u(9,Q,2,1,"div",6)(10,X,2,1,"div",7)(11,ne,28,5,"div",8),r()),e&2&&(l(8),d("ngForOf",n.newsList),l(),d("ngIf",n.successMessage),l(),d("ngIf",n.errorMessage),l(),d("ngIf",n.showModal))},dependencies:[A,z,T,V,D,S,E,I,F,j,B,L],styles:['@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Light.ttf) format("truetype");font-weight:300;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-LightItalic.ttf) format("truetype");font-weight:300;font-style:italic}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-Black.ttf) format("truetype");font-weight:900;font-style:normal}@font-face{font-family:Merriweather;src:url(/assets/Merriweather/Merriweather-BlackItalic.ttf) format("truetype");font-weight:900;font-style:italic}*[_ngcontent-%COMP%]{font-family:Merriweather}.container-fluid[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:20px}body[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]{font-family:Merriweather}.text-primary[_ngcontent-%COMP%]{font-family:Merriweather;font-size:2rem;color:#1a1a1a;font-weight:700;margin-bottom:20px;text-align:center}.dropdown-button[_ngcontent-%COMP%]{background:transparent;border:none;font-size:1.5rem;color:#1a1a1a;cursor:pointer;position:absolute;top:10px;right:10px;padding:0}.dropdown-button[_ngcontent-%COMP%]:hover{color:#ffb800}.instructions-container[_ngcontent-%COMP%]{position:relative;display:inline-block}.instructions-popup[_ngcontent-%COMP%]{background-color:#fff;padding:10px;border-radius:8px;box-shadow:0 2px 6px #00000026;position:absolute;top:40px;right:0;width:200px;font-size:.9rem;z-index:5}.btn[_ngcontent-%COMP%]{padding:10px 20px;font-size:1rem;border-radius:8px;border:2px solid #FFB800;cursor:pointer;transition:transform .3s ease,box-shadow .3s ease,background-color .3s ease,color .3s ease;background-color:#fff;color:#1a1a1a;display:inline-block;margin:10px 5px}.btn[_ngcontent-%COMP%]:hover{background-color:#ffb800;color:#fff;box-shadow:0 4px 10px #0003}.btn-primary[_ngcontent-%COMP%], .btn-info[_ngcontent-%COMP%], .btn-warning[_ngcontent-%COMP%], .btn-danger[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%], .btn-success[_ngcontent-%COMP%]{font-family:Merriweather,serif;background-color:#fff;color:#1a1a1a;border:2px solid #FFB800}.btn-primary[_ngcontent-%COMP%]:hover, .btn-info[_ngcontent-%COMP%]:hover, .btn-secondary[_ngcontent-%COMP%]:hover, .btn-warning[_ngcontent-%COMP%]:hover, .btn-success[_ngcontent-%COMP%]:hover{font-family:Merriweather,serif;background-color:#ffb800;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#666;color:#fff}.news-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:30px;margin-top:40px}.news-item[_ngcontent-%COMP%]{font-family:Merriweather;background-color:#fff;padding:8px 20px;border-radius:10px;box-shadow:0 4px 12px #0000001a;border:3px solid #FFB800;transition:transform .3s ease,box-shadow .3s ease,background-color .3s ease;display:flex;flex-direction:column;justify-content:space-between;overflow:hidden;height:100%}.news-item[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 20px #00000026}.automatic-news[_ngcontent-%COMP%]{border:3px solid #FFB800;background-color:#fff3cd}.media-container[_ngcontent-%COMP%]{position:relative;width:100%;height:250px;margin-bottom:15px}.media-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .media-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);max-height:100%;max-width:100%;object-fit:contain}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#000000b3;display:flex;justify-content:center;align-items:center;z-index:9999}.modal-content[_ngcontent-%COMP%]{font-family:Merriweather,serif;background-color:#fff;padding:25px;border-radius:10px;width:90%;max-width:600px;box-shadow:0 8px 16px #0000004d;position:relative;animation:_ngcontent-%COMP%_slideIn .3s ease}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translateY(-30px);opacity:0}to{transform:translateY(0);opacity:1}}.close-button[_ngcontent-%COMP%]{font-size:1.5rem;color:#333;cursor:pointer;position:absolute;top:10px;right:15px}.form-group[_ngcontent-%COMP%]{font-family:Merriweather;margin-bottom:20px}.form-label[_ngcontent-%COMP%]{font-family:Merriweather;font-weight:700;margin-bottom:5px}.form-input-large[_ngcontent-%COMP%]{font-family:Merriweather;width:90%;padding:15px;font-size:1.2rem;border-radius:4px;border:1px solid #ccc;margin-bottom:15px}.form-input[_ngcontent-%COMP%]{font-family:Merriweather;padding:12px;border:1px solid #ddd;border-radius:5px;font-size:1rem;width:100%}.modern-file-upload[_ngcontent-%COMP%]{position:relative;width:100%}.form-input-file[_ngcontent-%COMP%]{opacity:0;position:absolute;width:100%;height:100%;cursor:pointer;z-index:2}.file-input-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block;border:2px solid #FFB800;border-radius:8px;padding:12px 20px;background-color:#fff;transition:background-color .3s ease,box-shadow .3s ease}.file-input-label[_ngcontent-%COMP%]{font-family:Merriweather;color:#1a1a1a;font-size:1rem;display:flex;align-items:center;cursor:pointer;z-index:1}.file-input-label[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:1.5rem;margin-right:10px}.file-input-wrapper[_ngcontent-%COMP%]:hover{background-color:#ffb800;color:#fff;box-shadow:0 4px 10px #0003}.file-input-wrapper[_ngcontent-%COMP%]:hover   .file-input-label[_ngcontent-%COMP%]{color:#fff}.media-preview[_ngcontent-%COMP%]{margin-top:15px;text-align:center}.img-preview[_ngcontent-%COMP%], .video-preview[_ngcontent-%COMP%]{max-width:100%;max-height:250px;border-radius:8px;object-fit:contain;box-shadow:0 4px 8px #0000001a}.alert-confirmation[_ngcontent-%COMP%]{position:fixed;top:10%;left:50%;transform:translate(-50%);max-width:80%;padding:15px 20px;z-index:1050;font-size:1.2rem;font-weight:700;box-shadow:0 4px 8px #0003;border-radius:8px;animation:_ngcontent-%COMP%_slideDown .5s ease-in-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translate(-50%,-50%)}to{opacity:1;transform:translate(-50%)}}.alert-success[_ngcontent-%COMP%]{background-color:#43b02a;color:#fff;border:1px solid #FFB800}.alert-danger[_ngcontent-%COMP%]{background-color:#666;color:#fff;border:1px solid #FFB800}body[_ngcontent-%COMP%]{font-family:Merriweather;font-size:1rem;line-height:1.6}.news-item[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-family:Merriweather;font-size:1.25rem;margin-bottom:15px}']})};export{G as NewsCommonComponent};
