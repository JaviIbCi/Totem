<!-- index-collaborator.component.html -->

<main class="fondo">
  <!-- Sidebar / Filtros -->
  <aside class="sidebar" [ngClass]="{ 'mobile-sidebar': isMobileView }">
    <!-- Botones para filtrar entre Docentes y Administrativos -->
    <div class="filter-btn-group">
      <button
        (click)="filterByGroup('Docentes')"
        class="filter-btn"
        [ngClass]="{ active: selectedGroup === 'Docentes' }"
      >
        Docentes

      </button>
      <button
        (click)="filterByGroup('Administrativos')"
        class="filter-btn"
        [ngClass]="{ active: selectedGroup === 'Administrativos' }"
      >
        Administrativos

      </button>
    </div>

    <!-- Categorías: Mostrar categorías basadas en el grupo seleccionado -->
    <div class="categories" *ngIf="selectedGroup">
      <!-- Grupos de Docentes -->
      <ul *ngIf="selectedGroup === 'Docentes'">
        <li *ngFor="let group of getDocenteGroups()">
          <button class="category-toggle" (click)="toggleCategory(group)">
            {{ group }}  {{ isCategoryOpen(group) ? '▼' : '▲' }}

          </button>

          <!-- Mostrar categorías -->
          <ul *ngIf="isCategoryOpen(group)">
            <li *ngFor="let category of getDocenteCategories(group)">
              <button
                (click)="filterByCategory(category.category_name)"
                class="filter-option-btn"
                [ngClass]="{
                  active: selectedCategory === category.category_name
                }"
              >
                {{ category.category_name }}
              </button>
            </li>
          </ul>
        </li>
      </ul>

      <!-- Grupos Administrativos -->
      <ul *ngIf="selectedGroup === 'Administrativos'">
        <li *ngFor="let group of getAdministrativeGroups()">
          <button class="category-toggle" (click)="toggleCategory(group)">
            {{ group }}  {{ isCategoryOpen(group) ? '▼' : '▲' }}

          </button>

          <!-- Mostrar categorías -->
          <ul *ngIf="isCategoryOpen(group)">
            <li *ngFor="let category of getAdministrativeCategories(group)">
              <button
                (click)="filterByCategory(category.category_name)"
                class="filter-option-btn"
                [ngClass]="{
                  active: selectedCategory === category.category_name
                }"
              >
                {{ category.category_name }}
              </button>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </aside>

  <!-- Contenido Principal -->
  <section class="content">
    <!-- Barra de búsqueda -->
    <input
      type="text"
      placeholder="Buscar colaboradores..."
      class="search-bar"
      [(ngModel)]="searchTerm"
      (focus)="openVirtualKeyboard()"
      (input)="searchCollaborators()"
    />

    <!-- Paginación (arriba de los colaboradores) -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <button
        class="page-nav"
        (click)="previousPage()"
        [disabled]="currentPage === 1"
      >
        &lt;
      </button>

      <!-- Números de página -->
      <ng-container *ngFor="let page of paginationArray">
        <button
          *ngIf="page !== '...'"
          class="page-number"
          [ngClass]="{ active: currentPage === page }"
          (click)="goToPage(page)"
        >
          {{ page }}
        </button>
        <span *ngIf="page === '...'" class="dots">...</span>
      </ng-container>

      <button
        class="page-nav"
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
      >
        &gt;
      </button>
    </div>

    <!-- Contenedor scrollable para tarjetas -->
    <div class="cards-wrapper">
      <div class="cards-container">
        <!-- Mostrar colaboradores filtrados -->
        <div class="cards" *ngIf="paginatedCollaborators.length > 0">
          <div
            class="card"
            *ngFor="let collaborator of paginatedCollaborators"
            (click)="selectCollaborator(collaborator)"
          >
            <div class="image-container">
              <img
                [src]="
                  'https://totemvespucio.cl/assets/colaboradores/' +
                  collaborator.image_path
                "
                (error)="
                  onImageError($event, '/images/collaborator-placeholder.webp')
                "
                alt="{{ collaborator.first_name }} {{ collaborator.last_name }}"
                class="profile-img"
              />
            </div>
            <h3>
              {{ collaborator.first_name }} {{ collaborator.last_name }}
            </h3>
            <p>{{ collaborator.role }}</p>
            <p class="email">{{ collaborator.email }}</p>
          </div>
        </div>

        <!-- Mensaje cuando no se encuentran colaboradores -->
        <div
          *ngIf="
            paginatedCollaborators.length === 0 && selectedCategory
          "
        >
          <p>No se encontraron colaboradores en esta categoría.</p>
        </div>
      </div>
    </div>

    <!-- Paginación (debajo de los colaboradores) -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <button
        class="page-nav"
        (click)="previousPage()"
        [disabled]="currentPage === 1"
      >
        &lt;
      </button>

      <!-- Números de página -->
      <ng-container *ngFor="let page of paginationArray">
        <button
          *ngIf="page !== '...'"
          class="page-number"
          [ngClass]="{ active: currentPage === page }"
          (click)="goToPage(page)"
        >
          {{ page }}
        </button>
        <span *ngIf="page === '...'" class="dots">...</span>
      </ng-container>

      <button
        class="page-nav"
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
      >
        &gt;
      </button>
    </div>
  </section>

  <!-- Contenedor para el teclado virtual -->
  <div
    *ngIf="isKeyboardVisible"
    class="keyboard-container"
  >
    <!-- Botón de cierre -->
    <button
      class="close-button"
      (click)="closeVirtualKeyboard()"
    >
      X
    </button>
    <!-- Teclado virtual -->
    <div id="keyboard" class="simple-keyboard"></div>
  </div>
</main>
